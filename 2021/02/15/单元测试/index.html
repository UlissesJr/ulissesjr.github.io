<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><meta name="description" content="单元测试 [ Luobogan ] "><meta name="theme-color" content="#ebc65a"><title>单元测试 [ Luobogan ] </title><style>@font-face {
  font-family: 'Abril Fatface';
  font-style: normal;
  font-weight: 400;
  src: local('Abril Fatface'), local('AbrilFatface-Regular'), url(data:font/woff2;base64,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) format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Abril Fatface';
  font-style: normal;
  font-weight: 400;
  src: local('Abril Fatface'), local('AbrilFatface-Regular'), url(data:font/woff2;base64,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BL3+M1K+NfPvjlJEHZTOrkYvtdprqx0Hka+W/IhsQoUJE0jsPVOhV2itgp3Wame8dsB73DeCOfp+FMSxp2At3aozP1zVQ/tmEpXdveum7kat3CaLXRcmTZHmOveMiqxSteCZOrGKmscOa9WycTUXtRFabrtts1Nb3e5qHtqWPMWtuEkMSdydcarhKoTcVXtBgujKwULbPFJvqywIzBjboUacECG6ajlIews5dBUMkJ/LYHa12gpRLEsBDAAA6raxOaTnbx4GG5J6hdn4twxT1DRvEQZvD6banOa3BbstVh48efHmw5cffwECBQkWIvK/LTbhIkSKEi1GrDjxEiRKkixFqjTpMmTKki1Hrjz5ChQqUqxEqTLlKlSqUq2e+hpoqJHGmmiqmeZhWGKoYfaZ7qXhxhtjnlWWxsBotw0xxWdfjDPDSEfc98l8q33z1XeLrXPKCeu10NJErZzR2kmnXXDWOee90sYVF12yQVsfTXLdVde088Y7o3TQXkedddLFQnb/qVGrq24cuuvhtZ5666WPfvraaZEB+htokLfe2+1GBDbalARuuueWzbbYboejttrmmBHW2O+AvUmRDMb6EEUsHHQoDskRjxRIiVRILev2qn1oaGpomZOB2z/jmn/eUk6tvaZda/5znbhPCguQ7wsEvd1strBI3OYR8ye01+ZO0jbH36oqKm37w90hl2v/wO5o3vIjtpoZx20H) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
</style><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><script src="https://cdn.bootcss.com/highlight.js/9.6.0/highlight.min.js" defer></script><script src="/js/paper.js" defer></script><script src="https://www.googletagmanager.com/gtag/js?id=xx-xxxxxxx-xx" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'xx-xxxxxxx-xx');</script><link rel="stylesheet" href="/css/tocbot.css"><script src="/js/tocbot.js" defer></script><script>window.addEventListener('DOMContentLoaded', () => {
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.toc__content',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.article__content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    // For headings inside relative or absolute positioned containers within content.
    hasInnerContainers: true,
    orderedList: false,
    collapseDepth: 2,
  });
})</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
  }
});
MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
  }
});</script><link rel="preload" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css"><link rel="preload" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap"><meta name="generator" content="Hexo 5.3.0"></head><body><div class="mask-border"></div><div class="head"><div class="head__inner"><h1><a href="/">Luobogan</a></h1><p></p></div></div><div class="paper-container"><div class="main"><div class="location-bar"><div class="line-1"><div class="horizontal-line" style="height: 3px"></div></div><div class="line-2"><div class="horizontal-line" style="height: 1px"></div></div><p class="text">单元测试</p><div class="switch-button"><input class="container_toggle" type="checkbox" id="switch" name="mode"><label for="switch">Toggle</label></div><div class="line-3"><div class="horizontal-line" style="height: 1px"></div></div></div><div class="main__2-col"><article class="post-view__article"><div class="article__infomation"><div class="posts-item"><h2 class="posts-item__title"><a href="">单元测试</a></h2><span class="post__date">2021-02-15</span><a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"><span class="post__tags">#单元测试</span></a></div></div><div class="article__content"><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><blockquote>
<p>要成为专业程序员，请从编写单元测试开始。通过单元测试，证明你写的每一个类的每一个有意义的公开方法在各种正常和异常的条件下都遵守它的API契约，符合你的设计意图，从软件最底层的实现代码开始证明你写的程序的正确性和可靠性。毕竟，如果你都不能证明底层代码的正确性和可靠性，又怎敢觍颜声称自己是“专业程序员”？</p>
<h2 id="TDD：先写好单元测试，再写实现代码通过测试"><a href="#TDD：先写好单元测试，再写实现代码通过测试" class="headerlink" title="TDD：先写好单元测试，再写实现代码通过测试"></a>TDD：先写好单元测试，再写实现代码通过测试</h2></blockquote>
<p>是否采用测试驱动开发（简称TDD），是专业程序员与业余程序员的分水岭。</p>
<p>TDD是多个敏捷方法论力推的最佳实践之一。如果只能保留一个敏捷最佳实践，我必然是保留TDD。如果可以保留两个，那就再加上持续集成。</p>
<p>采用与不采用TDD，代码质量和设计质量有天壤之别。</p>
<p>不采用TDD的，也有写的好的代码（但很罕见）。采用TDD的，基本都是好代码。长期坚持TDD，程序员的的代码和设计会越来越好。你会感觉写代码越来越像写诗，而不是像搬砖；你自己成了诗人，而不再是悲催的码农。你不再需要加班加点寻找和改正Bug；你不再需要担心在一个地方修改代码会导致在意想不到的地方冒出新的几个Bug，即使有，你也可以及时发现、准确定位Bug并加以改正；你晚上会睡得比较安稳，不用担心领导或客户半夜的夺命连环call；你对自我形象感觉满意，因为在同事、领导和客户面前书里了专业、可靠的形象。</p>
<p>JUnit、AssertJ和Mockito是单元测试三剑客。JUnit用于编写和执行测试，AssertJ用于编写断言，而Mockito用于编写测试替身，以隔离被测类的协作者，使得测试范围真正局限于代码“单元”，而不至于变成集成测试。</p>
<h2 id="什么是单元测试"><a href="#什么是单元测试" class="headerlink" title="什么是单元测试"></a>什么是单元测试</h2><blockquote>
<p>单元测试用于测试一个独立的工作单元的执行结果是否符合预期。</p>
</blockquote>
<p>一个工作单元就是一项任务，不直接依赖于其他任何任务的完成。在面向对象的编程语言例如Java中，一个工作单元通常是（但不总是）一个类中的一个非private的方法。因此，单元测试是最细粒度的测试。相比之下，集成测试和验收测试检查的是各个组件如何交互，是更粗粒度的测试。</p>
<p>单元测试通常关注的是一个方法是否遵循了它的API契约中的条款。通常而言，在单元测试中，我们会依照下面的步骤进行测试：</p>
<ol>
<li>创建被测对象；</li>
<li>将测对象的设置到一个初始状态，包括注入被测对象的所依赖的协作对象的实例；</li>
<li>使用指定的参数集调用被测对象的方法，执行测试；</li>
<li>断言方法执行的结果符合预期。</li>
</ol>
<p>执行结果通常有以下三种形式：</p>
<ol>
<li>对于有返回值的方法，断言方法的返回值符合预期</li>
<li>对于没有返回值的方法，断言它产生的副作用（例如：修改了对象的内部状态，调用了协作对象）符合预期。</li>
<li>抛出了我们预期的异常。例如对于ATM机应用，当测试中的取款金额超出了账户的可用余额时，断言取款方法调用会抛出BalanceInsufficientException异常。或者当账户被冻结时，断言调用取款方法会抛出AccountLockedException异常。</li>
</ol>
<blockquote>
<p>单元测试用于检验被测类中的一个工作单元（通常是一个非private的方法）在各种正常和异常条件下被调用时的响应（返回值、副作用、抛出异常）都符合设计者的预期。</p>
</blockquote>
<p>例如，当我们设计银行账户类Account的取款方法withdraw(double amount)时，我们的设计意图包括下面几个要点：</p>
<ul>
<li>当withdraw()方法被调用时，如果Account的状态正常且当前可用余额不小于取款金额Amount，则方法应当正常返回。当前余额更新为原余额-取款金额（产生了副作用——修改了Account对象的内部状态）。</li>
<li>如果Account的状态正常且取款金额大于账户的当前可用余额，方法应该调用失败并抛出BalanceInsufficientException异常。Account的当前可用余额不变。</li>
<li>如果账户被冻结，无论余额是否足够，调用withdraw()方法都应该失败并抛出AccountLockedException异常。Account的当前可用余额不变。</li>
</ul>
<p>以上就是要设计的Account类的withdraw()方法的API契约。我们应该针对上面几种情况编写一组单元测试，以保证在以上3种状况下调用withdraw()方法的响应都符合设计意图。如果上面的单元测试都通过了，我们的系统就可以保证：</p>
<ul>
<li>账户被冻结时候取款不会成功。</li>
<li>账户未被冻结且余额足够时可以正常取款。</li>
<li>余额不足时取款失败。</li>
<li>如果取款成功，账户的余额必须相应减少。</li>
<li>如果取款失败，不管是由于余额不足还是账户被冻结，账户的当前余额都不变。</li>
</ul>
<h2 id="为什么一定要写单元测试"><a href="#为什么一定要写单元测试" class="headerlink" title="为什么一定要写单元测试"></a>为什么一定要写单元测试</h2><ul>
<li>保证代码正确性</li>
<li>保证代码在边缘状态和异常条件下的正确性</li>
<li>通过回归测试保证代码在未来的正确性</li>
<li>单元测试帮助及时发现和定位Bug</li>
<li>单元测试作为代码的文档，为他人和未来的自己指路</li>
<li>可测试性的要求会防止程序员写出糟糕的代码</li>
<li>减轻心理负担，自信地编码</li>
<li>树立专业形象，获得同事、上司、客户的认可与赏识</li>
</ul>
<h2 id="软件测试的类别"><a href="#软件测试的类别" class="headerlink" title="软件测试的类别"></a>软件测试的类别</h2><ul>
<li>单元测试。对底层代码的每个工作单元进行测试。通常涉及一个类的一个公开方法。白盒测试。细粒度。</li>
<li>集成测试。中等粒度的测试。对多个类之间的协作或与外部系统的交互以完成某项内部功能进行测试。涉及多个类的交互。白盒测试。中等粒度。</li>
<li>功能测试。粗粒度的测试。针对系统的每个用例（对客户或用户有用的功能）进行测试。黑盒测试。粗粒度。</li>
<li>性能和负载测试。测试系统的性能和吞吐量等。黑盒测试。</li>
<li>验收测试。从用户界面开始对整个系统进行测试验收，检验系统是否已经准备就绪，可以部署生产。<br><img src="https://i.loli.net/2021/02/22/w2eKWp3sNPQvJEX.png" alt="软件测试分类.png"></li>
</ul>
<p><strong>说明：</strong></p>
<ul>
<li>白盒和黑盒测试。白盒测试是看得见内部代码情况下进行的测试，包括单元测试和集成测试。由程序员而不是测试人员编写和运行，用于验证自己写的代码和/或交互是否正确。黑盒测试是不了解/不关心系统的代码和内部结构的情况下进行的测试，包括功能测试、性能和负载测试以及验收测试。由测试人员编写和运行，用于验证系统的功能和表现是否满足客户和用户的需要。</li>
<li>外部功能与内部功能。外部功能代表一项功能需求（例如存款、取款、申报、索赔等等），由客户或产品经理定义，是系统的业务价值所在，呈现系统的外部可见的属性和行为。内部功能由开发人员定义，可能是业务性的，也可能是技术性的，用于实现外部功能和质量，呈现系统内部的结构和机制。通常一项外部功能由多个内部功能协作完成。</li>
<li>协作者和外部系统。要完成一项功能，通常都涉及到多个类之间，或者类与外部系统之间的交互协作。与其他类之间交互的例子是：下订单的时候，订单服务类要调用定价服务类来获取订单中每项商品的当前价格。与外部系统的交互包括与数据库、缓存、消息中间件、文件系统、第三方服务提供者等等的交互。在单元测试中，要对所有的协作者和外部系统进行隔离和模拟。其他测试通常直接使用真实的协作者和外部系统，而不进行模拟。集成测试有时候会对部分外部系统进行模拟。</li>
</ul>
<h2 id="测试金字塔"><a href="#测试金字塔" class="headerlink" title="测试金字塔"></a>测试金字塔</h2><blockquote>
<p>Mike Cohn 在他的著作《Succeeding with Agile》一书中提出了这个测试金字塔这个概念。这个比喻非常形象，它让你一眼就知道测试是需要分层的。它还告诉你每一层需要写多少测试。<br><img src="https://i.loli.net/2021/02/22/1QpfTWYPMsh8nrS.png" alt="测试金字塔.png"></p>
</blockquote>
<p>在上图中，金字塔从下往上分别是单元测试、服务测试（相当于我们上面分类中的功能测试）和用户界面测试（相当于我们上面分类中的验收测试）。测试金字塔说明：</p>
<ul>
<li>越是底层的测试，测试的数量越多；越是上层的测试，测试的数量越少。单元测试的测试量是最大的。每个工作单元都需要编写测试。实际上每个工作单元通常都需要写多个测试，以保证对各种可能条件进行全面测试覆盖。</li>
<li>越是底层的测试，越需要能够快速执行。上层的测试则允许更长时间完成。所有的单元测试都应该能够在毫秒级时间内完成。</li>
<li>越是底层的测试，越需要隔离依赖项。越高层的测试，越需要集成更多的真实依赖项。底层的单元测试，要对一切依赖项（系统中的其他类和外部系统）进行隔离和模拟；而上层的测试需要集成系统中其他的类、子系统和外部系统，进行联合测试。</li>
</ul>
<p><strong>﻿各种测试不可相互取代</strong><br>各种测试之间不可相互代替。例如，单元测试用于保证最底层的每个工作单元的正确性（零件的正确性），集成测试用于保证多个类协作完成高阶目标（内部功能）的正确性（组装的正确性）。作为技术人员，我们肯定要首先保证每个零件没问题，然后也要保证这些零件组装起来后能够完成某项期待的功能。</p>
<h2 id="典型的错误观念和做法"><a href="#典型的错误观念和做法" class="headerlink" title="典型的错误观念和做法"></a>典型的错误观念和做法</h2><p><strong>错误观念</strong></p>
<ol>
<li>测试是测试人员的工作。程序员只应该写产品代码<br>测试人员只在乎整个系统在功能和外部质量方面是否满足客户和用户的需求，他们既不了解、也不在乎你写的代码和你的程序结构，因此他们只能编写黑盒测试而无法编写白盒测试。写代码和定义内部结构是程序员的工作，通过单元测试证明你的代码和结构的正确性和可靠性同样是程序员的工作。</li>
<li>编写单元测试会加重负担，拖慢进度<br>这是对单元测试最大的误解！跟我们的直觉恰恰相反，在软件的整个生命周期范围里面，编写单元测试会大大减轻负担，并且会让我们保持平稳的速度前进。没有单元测试，我们也许开始时速度会很快，但后面随着bug的不断爆发，很大一部分的时间会用于寻找、调试和修复bug，用于编写生产代码的时间越来越少，项目进展也会越来越慢。单元测试从一开始就大大减少了bug存在的可能性，出了bug也能够及时发现，准确定位，以最小的代价在最短的时间内修复bug。<br>首先，写单元测试所需要花的时间和精力微不足道。平均而言，写一个测试需要1分钟左右的时间。写10000个测试也只需要10000分钟，也就是7天时间，如果按8小时工作制计算，就是21个工作日。以10000个单元测试产生的收益相比，21个工作日真的不算什么。没有单元测试，在产品上线后出现bug之后通过调试等方法定位和修正bug所花的时间和成本要大的多。<br>其次，单元测试，特别是采用了TDD之后，会导致你的代码质量越来越好。可测试性迫使你编写简单的代码，从而使得代码更加容易理解、维护和修改。这也会提高产品质量和加快交付速度。</li>
<li>代码太简单，不值得编写单元测试</li>
<li>代码太复杂，很难编写单元测试测试<br>这个误解是导致很多程序员不敢尝试写单元测试的主要原因。不采用测试驱动开发的人，会先写产品代码，再写单元测试。他就有可能写出一个成百上千行代码的方法，方法里面包含大量的分支和循环，导致很难写测试。解决这个问题的方法就是采用TDD，测试先行！就是先写好单元测试，再编写产品代码来通过测试。采用测试先行的方式，就不会有“测试很难编写”的问题。因为你只是先写个测试表达你的需求，然后写最简单的代码去通过这个测试。测试通过了，就是需求实现了。</li>
<li>可以用集成测试和功能测试取代单元测试<br>集成测试和功能测试不可能覆盖所有的情况。被测方法的执行结果是受对象内部状态、对象依赖项的状态、环境状态、方法参数影响的。我们需要编写多个测试方法来分别测试每种情况。如果实现某个业务功能需要m个类的协作，而每个类的被调用方法有n种可能情况，如果我们要编写功能测试来覆盖所有可能状态，就需要编写m×n个测试方法。而如果写单元测试，就只需要写m+n个测试方法，再加上一两个功能测试，覆盖主要执行路径，证明多个对象之间的协作正常即可。<br>在单元测试中，可以使用模拟对象（后面将要讲述的Mockito就是用来创建模拟对象的）模拟被测类的依赖项，因此可以在依赖项开发出来之前就开始测试。而集成和功能测试则必须等待所有依赖项都开发出来之后才能执行测试。模拟类还可以模拟在真实环境下不会经常出现的极端情况，预先针对这些情况进行测试，而集成和功能测试只能消极等待这些情况的出现才能开始测试。</li>
<li>单元测试的受益者是客户和公司，我不“为他人做嫁衣裳”<br>单元测试可让多方受益。客户通过得到更好的产品受益，公司通过交付更好的产品受益。但最大的受益者是程序员自己。通过单元测试，我们可以自信地编码，稳定地前进。当未来由于修改、重构和扩展导致bug时，我们能够及时发现，准确定位，低成本修正bug，修正后通过回归测试还可以确认这次修正有没有不小心引入了新的bug。如果没有单元测试的保护，对于我们交付的代码，我们不知道有没有bug，bug的位置在哪里，修正bug之后会不会引入了新的bug。<blockquote>
<p>有单元测试的时候，我们的工作状态是自信、轻松、愉悦的，没有单元测试的时候，我们是忐忑、疲倦、怀疑自我的。这根本是两个世界。</p>
</blockquote>
</li>
</ol>
<p><strong>错误做法</strong></p>
<ol>
<li><p>单元测试只覆盖“快乐路径”</p>
</li>
<li><p>将单元测试写成了集成测试<br>这是很多初学者常见的错误做法。在测试中采用被测类的真实依赖项而不是测试替身，或者连接到数据库、本地文件系统、访问第三方服务等等就会将单元测试写成了集成测试。它不是测试单个类的单个方法，而是测试了相互协作的多个类，以及外部环境。</p>
</li>
<li><p>被测方法的响应结果是下列因素的函数：<br>1.被测类的内部状态。例如被测的账户类有个内部状态：当前余额。它会影响取款方法调用的结果：当取款金额不大于当前余额时，取款成功，当前余额也会相应减少。当取款金额大于当前余额时，取款失败，并抛出BalanceInsufficientException异常。账户类的另一个内部状态：账户状态也影响取款方法的执行结果。当账户状态的值是Locked时，取款失败，并抛出AccountLockedException。<br>2.被测类的依赖项的状态。例如被测的订单服务类依赖定价服务类提供当前商品价格。当客户下订单时，订单服务类的被测placeOrder()方法调用定价服务类的getCurrentPrice()方法。查询购物车中每一个货品的当前单价。这个定价服务是个远程服务。当定价服务可用且存在对货品的定价时，订单创建成功；当定价服务由于网络原因不可用时，应当抛出PriceServiceUnavailableException；当定价服务不包含购物车中某些商品时，应当抛出PriceNotFoundException。<br>3.环境状态。例如我们的购物网站只在每日8:00到22:00才会接受订单。那么在7:35下订单时，被测方法应当抛出OrderServiceUnavailableException异常。<br>4.方法参数。例如取款方法的“取款金额”参数。当取款金额小于账户当前余额时，被测方法会正常执行；大于当前余额时，会抛出BalanceInsufficientException异常。<br>在编写单元测试时，要针对上述因素的各种可能性编写测试。不能只测试一切正常状况下的测试（被称为“快乐路径”，例如取款方法的例子，只测试账户状态正常，余额足够，取款金额是个正数的情况），而对各种异常情况视而不见。近代历史上许多严重事故（温州动车事故，美国航天飞机事故），都是由于对设备或控制软件异常状况测试不足导致的，导致了惨重后果。</p>
</li>
<li><p>先写产品代码，再写单元测试<br>传统的做法是先写好产品代码，然后写单元测试去测试产品代码是否正确。但极限编程（XP）的发起人Kent Beck却主张测试先行，就是先写好单元测试，再编写代码去通过这个测试。在编写单元测试的时候，被测类和被测方法可能还不存在！这种颠覆性的做法能带来惊人的好处，通过单元测试表达需求，设置验收标准，在此过程中还能够驱动更好的设计！测试后行，单元测试只是个验证工具；测试先行，单元测试变成了设计工具！</p>
</li>
</ol>
<h2 id="编写第一个单元测试"><a href="#编写第一个单元测试" class="headerlink" title="编写第一个单元测试"></a>编写第一个单元测试</h2><h3 id="1-需求："><a href="#1-需求：" class="headerlink" title="1.需求："></a>1.需求：</h3><p>我们要测试一个银行账户类Account的“取款”工作单元——withdraw()方法。我们先定义这个方法的契约：<br>如果账户被冻结，取款将失败，并抛出AccountLockedException异常<br>如果取款金额是0或者负数，取款将失败，并抛出InvalidAmountException异常。<br>如果余额不足，取款将失败，并抛出BalanceInsufficientException异常。<br>如果上述情况都没发生，取款将成功，账户余额会相应扣减，并在系统中记录这一笔交易。</p>
<p>﻿<strong>下面是关键的业务规则：</strong><br>如果取款由于任何原因失败，账户余额不会发生任何变化。<br>如果取款成功，账户余额将会相应减少，并在系统中记录这笔交易。</p>
<h3 id="2-实现"><a href="#2-实现" class="headerlink" title="2.实现"></a>2.实现</h3><p><strong>被测类Account</strong><br>基于上面的契约和规则，我们编写了下面的实现（此处暂不采用TDD，我们先写好产品代码，再编写测试）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobo.gan.tdd.bank;</span><br><span class="line"><span class="comment">//被测对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="comment">//内部状态：账户是否被冻结</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> locked = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//内部状态：当前余额</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> balance = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//外部依赖（协作者）：记录每一笔收支</span></span><br><span class="line">    <span class="keyword">private</span> Transactions transactions;</span><br><span class="line">    <span class="comment">//用于注入外部协作者的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactions</span><span class="params">(Transactions transactions)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transactions = transactions;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> locked;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//存款工作单元</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deposit</span><span class="params">(<span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//失败路径1：账户被冻结时不允许存款</span></span><br><span class="line">        <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AccountLockedException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//失败路径2：存款金额不是正数时不允许存款</span></span><br><span class="line">        <span class="keyword">if</span> (amount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InvalidAmountException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//成功（快乐）路径</span></span><br><span class="line">        balance += amount; <span class="comment">//存款成功后改变内部状态</span></span><br><span class="line">        transactions.add(<span class="keyword">this</span>, TransactionType.DEBIT, amount); <span class="comment">//存款成功后调用外部协作者</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//取款工作单元</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">withdraw</span><span class="params">(<span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//失败路径1：账户被冻结时不允许取款</span></span><br><span class="line">        <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AccountLockedException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//失败路径2：取款金额不是正数时不允许取款</span></span><br><span class="line">        <span class="keyword">if</span> (amount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InvalidAmountException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//失败路径3：取款金额超过余额时不允许取款</span></span><br><span class="line">        <span class="keyword">if</span> (amount &gt; balance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BalanceInsufficientException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//成功（快乐）路径</span></span><br><span class="line">        balance -= amount;   <span class="comment">//取款成功后改变内部状态</span></span><br><span class="line">        transactions.add(<span class="keyword">this</span>, TransactionType.CREDIT, amount); <span class="comment">//取款成功后调用外部协作者</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//冻结工作单元</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        locked = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//解冻工作单元</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        locked = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>代码说明如下：<br>Account类有三个字段，其中locked和balance是两个内部状态，分别代表冻结状态和当前余额；transactions是外部依赖（协作者），用来记录存取交易。<br>Account类提供了isLocked()和getBalance()方法，分别将locked和balance内部状态暴露给外界。<br>Account类提供了lock()和unlock()方法来设置locked内部状态，deposit()和withdraw()来更改balance内部状态。<br>Account类提供了setTransactions()方法，用来注入外部依赖。<br>﻿<br><strong>外部依赖Transactions接口</strong><br>Transactions接口提供了记录每一笔存款、取款交易的方法add():<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Transactions</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Account account, TransactionType transactionType, <span class="keyword">int</span> amount)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>第一个参数记录交易关联的账户，第二个参数TransactionType是个枚举，表明是存款还是取款。第三个参数表示存取金额。</p>
<p><strong>单元测试</strong><br>针对withdraw()契约和业务规则，我们编写下面一组单元测试来对它进行全面测试覆盖：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobo.gan.tdd.bank;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertThrows;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountWithdrawTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ORIGINAL_BALANCE = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Transactions transactions;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        account = <span class="keyword">new</span> Account();</span><br><span class="line">        transactions = mock(Transactions.class);</span><br><span class="line">        account.setTransactions(transactions);</span><br><span class="line">        account.deposit(ORIGINAL_BALANCE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//账户状态正常，取款金额小于当前余额时取款成功</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shouldSuccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> amountOfWithdraw = <span class="number">2000</span>;</span><br><span class="line">        account.withdraw(amountOfWithdraw);</span><br><span class="line">        assertThat(account.getBalance()).isEqualTo(ORIGINAL_BALANCE - amountOfWithdraw);</span><br><span class="line">        verify(transactions).add(account, TransactionType.CREDIT, amountOfWithdraw);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将余额全部取完，也可以取款成功</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shouldSuccessWhenWithdrawAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        account.withdraw(ORIGINAL_BALANCE);</span><br><span class="line">        assertThat(account.getBalance()).isEqualTo(<span class="number">0</span>);</span><br><span class="line">        verify(transactions).add(account, TransactionType.CREDIT, ORIGINAL_BALANCE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//账户被冻结，取款应当失败</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shouldFailWhenAccountLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        account.lock();</span><br><span class="line">        assertThrows(AccountLockedException.class, () -&gt; &#123;</span><br><span class="line">            account.withdraw(<span class="number">2000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        assertThat(account.getBalance()).isEqualTo(ORIGINAL_BALANCE);</span><br><span class="line">        verify(transactions, never()).add(account, TransactionType.CREDIT, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款金额是负数，取款应当失败</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shouldFailWhenAmountLessThanZero</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThrows(InvalidAmountException.class, () -&gt; &#123;</span><br><span class="line">            account.withdraw(-<span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        assertThat(account.getBalance()).isEqualTo(ORIGINAL_BALANCE);</span><br><span class="line">        verify(transactions, never()).add(account, TransactionType.CREDIT, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款金额是0，应当失败</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shouldFailWhenAmountEqualToZero</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThrows(InvalidAmountException.class, () -&gt; &#123;</span><br><span class="line">            account.withdraw(<span class="number">0</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        assertThat(account.getBalance()).isEqualTo(ORIGINAL_BALANCE);</span><br><span class="line">        verify(transactions, never()).add(account, TransactionType.CREDIT, ORIGINAL_BALANCE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//余额不足，应当失败</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shouldFailWhenBalanceInsufficient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThrows(BalanceInsufficientException.class, () -&gt; &#123;</span><br><span class="line">            account.withdraw(ORIGINAL_BALANCE + <span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        assertThat(account.getBalance()).isEqualTo(ORIGINAL_BALANCE);</span><br><span class="line">        verify(transactions, never()).add(account, TransactionType.CREDIT, ORIGINAL_BALANCE + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>上面的测试代码采用JUnit 5，Mockito 3和AssertJ 3编写。需要在JDK 8以上的版本运行。<br><strong>说明：</strong><br>标注了@Test的方法是测试方法。方法没有返回值。一般情况下也没有参数。方法名字可以任意取，但最好能够充分表达测试意图。s<br>标注了@BeforeEach的方法，会在每一个测试方法执行之前都执行一次。方法名字可以任意取。</p>
<p>从上面每一个测试方法来看，每个测试通常都包含以下的过程：</p>
<ol>
<li>﻿创建被测对象。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">account = <span class="keyword">new</span> Account();</span><br></pre></td></tr></table></figure>
<ol>
<li>设置内测对象的内部状态并注入外部依赖。对于单元测试，外部依赖应该用测试替身代替</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用Mockito创建测试替身，它实现了Transactions接口</span></span><br><span class="line">transactions = mock(Transactions.class);</span><br><span class="line"><span class="comment">//注入测试替身</span></span><br><span class="line">account.setTransactions(transactions);    </span><br><span class="line"><span class="comment">//调用存款方法，设置初始余额</span></span><br><span class="line">account.deposit(ORIGINAL_BALANCE);    </span><br><span class="line"><span class="comment">//调用冻结方法，设置冻结状态</span></span><br><span class="line">account.lock();</span><br></pre></td></tr></table></figure>
<ol>
<li>调用被测试方法，执行测试。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">account.withdraw(amountOfWithdraw);</span><br></pre></td></tr></table></figure>
<ol>
<li>断言测试结果</li>
</ol>
<p>成功时断言修改了内部状态并调用了外部依赖的方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//断言当前余额等于原有余额减去取款金额</span></span><br><span class="line">assertThat(account.getBalance()).isEqualTo(ORIGINAL_BALANCE - amountOfWithdraw);</span><br><span class="line"><span class="comment">//断言调用了外部依赖transactions的add()方法，以account, TransactionType.CREDIT, amountOfWithdraw为参数</span></span><br><span class="line">verify(transactions).add(account, TransactionType.CREDIT, amountOfWithdraw);</span><br></pre></td></tr></table></figure><br>失败时断言抛出了期待的异常，余额没有减少并且没有调用外部依赖transactions来创建交易记录：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//断言调用被测方法后抛出AccountLockedException异常</span></span><br><span class="line">assertThrows(AccountLockedException.class, () -&gt; &#123;</span><br><span class="line">    account.withdraw(<span class="number">2000</span>);</span><br><span class="line">&#125;); </span><br><span class="line"><span class="comment">//断言余额没有减少</span></span><br><span class="line">assertThat(account.getBalance()).isEqualTo(ORIGINAL_BALANCE);</span><br><span class="line"><span class="comment">//断言没有调用外部依赖的方法</span></span><br><span class="line">verify(transactions, never()).add(account, TransactionType.CREDIT, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><br>上面的单元测试用到了本文将要介绍的三大框架：<br>JUnit用来编写测试的主体<br>Mockito用来创建外部依赖的测试替身，注入到被测对象。<br>AssertJ用来编写各种断言，断言单元测试的结果。虽然JUnit也包含了本身的断言库，但是内容不够丰富，形式不够优美。用AssertJ来写断言可读性等方面会好得多。</p>
<h2 id="测试哪些内容-Right-BICEP"><a href="#测试哪些内容-Right-BICEP" class="headerlink" title="测试哪些内容 Right-BICEP"></a>测试哪些内容 Right-BICEP</h2><p>Right——结果是否正确？<br>B——是否所有的边界条件都是正确的？<br>I——能查一下反向关联吗？<br>C——能用其他手段交叉检查一下结果吗？<br>E——你是否可以强制错误条件发生？<br>P——是否满足性能要求？</p>
<ol>
<li>结果是否正确</li>
</ol>
<p>例如对于上一节的取款案例：原有余额10000元，取款2000后，余额应该剩下8000元。我们就要测试这个结果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertThat(account.getBalance()).isEqualTo(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><br>断言失败就表明实现代码有错，需要修改后重新测试。</p>
<ol>
<li>边界条件</li>
</ol>
<p>代码中的bug往往都出现在“边界条件”附近,也就是说,在那些条件下,代码的行为可能不同于平常的、每天都能运行到的程序路径。例如：</p>
<ul>
<li>我们期待接受一个代表文件路径的字符串，但客户代码可能传入一个包含回车或冒号的字符串。</li>
<li>我们期待接受一个代表email的字符串，但客户代码可能传入一个没有包含“@”的字符串。</li>
<li>我们期待接受一个正数，但客户代码可能传入0或负数。</li>
<li>我们期待传入一个对象，但客户代码可能传入null。</li>
<li>我们要从传入的集合中选择第一个元素，但客户代码传入了一个空集合。<br>如果你是一个桥梁工程师，大桥建好之后，你不能只是在风和日丽的日子里，让一辆车缓缓驶过桥面，就宣布大桥经过了充分测试。作为工作单元的实现者，我们的代码交付后，代码的用户可能会用各种奇葩的方式调用我们的代码，我们必须预先针对这种种可能情况预先设计应对策略，并通过单元测试来确保工作单元在各种边界条件下都会按照我们的预设策略那样执行。<br>一个想到可能的边界条件的简单办法就是记住助记词<strong>CORRECT</strong>。</li>
</ul>
<ol>
<li>检查反向关联</li>
</ol>
<p>例如我们要检查求平方根的函数squareRoot()的正确性，就可以通过检查平方根的平方是否等于当初的参数的当时来检查代码实现的正确性：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSquareRootUsingInverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">double</span> result = squareRoot(a);</span><br><span class="line">    assertThat(result * result).isCloseTo(a, Percentage.withPercentage(<span class="number">0.00001</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>上面的测试代码用于测试squareRoot(double a)函数的正确性。a的平方根的平方应该等于a。<br><strong>说明:</strong> 在计算机中浮点数无法精确比较其相等性，因此，两个数只要足够接近，就可以认为相等。在上面的测试例子中，我们把足够接近定义为相差不超过0.00001%。</p>
<ol>
<li>使用其他手段来实现交叉检查</li>
</ol>
<p>通常而言，实现一个工作单元有一种以上的算法。我们选用其中一种最好的来作为我们的代码实现，但可以使用其余的算法来作为单元测试。当两者的计算结果都相同时，我们就可以认为我们的代码实现是正确的。当然前提是两种算法不会都是错误的，但恰好都产生相同的结果。<br>例如JDK标准库中已经有Math.sqrt()这样的一个平方根函数。当我们的平方根函数和标准库中的平方根函数得出的结果相同时，就可以认为我们的的平方根函数是正确的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSquareRootUsingStd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a = <span class="number">8</span>;</span><br><span class="line">    assertThat(squareRoot(a)).isCloseTo(Math.sqrt(a), Percentage.withPercentage(<span class="number">0.00001</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>强制产生错误条件</li>
</ol>
<p>在真实世界中，错误总会发生：磁盘会满，WIFI会断开，程序会崩溃。你应该能够通过主动强制引发这些错误，来测试你的代码在这样极端状态下是如何应对这些真实世界中的问题的。<br>这就是使用Mockito这样的测试替身库的作用之一——它们能够模拟各种各样的异常条件，而不需要无限期地消极等待真实世界中异常状态的出现。</p>
<ol>
<li>性能特性</li>
</ol>
<p>一般的性能测试是黑盒测试，采用JMeter这样的专门的性能测试工具进行测试。但是对于我们所写的代码，如果里面包含了复杂的循环，或者处理了大量的数据，那就应该在单元测试层面测试一下性能。<br>通常会有性能问题的测试都会耗时较长。我们不希望被这些测试拖慢进度。这时可以采用JUnit的测试分组策略，将这些耗时的测试分到另外的组，只在某些阶段执行一下测试。而其他的单元测试会经常运行。</p>
<h2 id="CORRECT-边界条件"><a href="#CORRECT-边界条件" class="headerlink" title="CORRECT 边界条件"></a>CORRECT 边界条件</h2><p>代码中的许多bug都出现在“边界条件”附近，也就是说，在那些条件下，代码的行为可能不同于平常的、每天都能运行到的程序路径。</p>
<p>在面向对象的编程中，对象的方法执行结果是对象内部字段和方法参数的函数。我们需要通过单元测试来确认，当字段和/或参数处于边界条件时，方法的执行结果符合我们的预期。</p>
<p>我们用首字母缩略词CORRECT来帮助你列举需要测试的边界条件（字段或参数的取值）：<br>Conformance（一致性）——值是否符合预期的格式？<br>Ordering（有序性）——一组值应该是有序的，还是无序的？<br>Range（区间性）——值是否在一个合理的区间之内？<br>Reference（耦合性）——代码是否引用了不受控的外部因素？<br>Existence（存在性）——值是否为空？<br>Cardinality（基数性）——是恰好有足够的值？<br>Time（时间性）——所有的事情是否都是按顺序发生的？是否在正确的时间？是否及时？</p>
<p>你需要好好回答的问题是：<br>还有什么可能出错？<br>并针对每个可能出错的地方编写一个测试。
﻿</p>
<ol>
<li>Conformance 一致性</li>
</ol>
<p>值格式是否符合要求？<br>例如，我们有个方法会从方法参数接收一个字符串形式的email地址，并随后向这个email地址发送一封标准化邮件。但是用户代码可能在调用这个方法时传入一个不包含“@”的字符串。如果实现代码中没有针对这种情况预先做好应对措施，就有可能在运行中出错。因此，应当针对这类情况预先编写单元测试，检验在传入不能转换成email地址的字符串时，方法的响应符合预期。<br>当然针对上面这个例子，更好的设计是设计一个EmailAddress类，并使用它作为方法的参数类型。这样就可以确保只有合法的email才能传递给方法，从而不需要针对这个方面编写单元测试。</p>
<ol>
<li>Ordering 有序性</li>
</ol>
<p>数据或调用是否遵循一定的顺序？<br>例如以下情况要测试顺序：<br>如果方法返回一个列表，列表中的元素是否确实按照我们设定的顺序排序？<br>如果方法执行中需要调用两个或两个以上不同的外部依赖（例如：先写入数据库，再写入缓存），调用时是否确实遵循我们要求的先后顺序？</p>
<ol>
<li>Range 区间性</li>
</ol>
<p>值是否位于合理的区间之内？<br>例如：<br>方法参数充值金额是不是正数？<br>两个方法参数，fromTime是否早于toTime？<br>数组的索引值是否超出范围？<br>这些都是需要进行单元测试检测的地方</p>
<ol>
<li>Reference 耦合性</li>
</ol>
<p>如果被测工作单元有外部依赖（其他协作类、数据库、文件系统等等）或环境依赖，工作单元的执行结果依赖于这些外部依赖的存在以及它们的状态，那么就应该针对这些情况编写单元测试，保证在这些依赖未满足的情况下运行良好。<br>主要测试这些方面：<br>外部依赖存在/不存在，状态正常/异常时，代码的行为是否符合预期？<br>测试完成后，代码是否像预期的那样调用了这些外部依赖（例如充值成功后是否更新了缓存中的余额）？</p>
<ol>
<li>Existence 存在性</li>
</ol>
<p>对于你传入或维护的值，先询问自己如果值不存在——如果它为null, 空集合，或者等于0，方法的行为将会怎样？<br>针对上面各种“值不存在”的情况分别编写单元测试。确保你的产品代码在值不存在的情况下的响应符合预期。</p>
<ol>
<li>Cardinality 基数性</li>
</ol>
<p>在《Pragmatic Unit Testing: In Java with JUnit》一书中举了这样一个例子：假设你正在维护一个披萨店的十大最受欢迎的食品列表。每次有新订单下来，这个列表都会进行自动调整，并将更新后的列表发送到老板的手机上。此时，你需要测试哪些内容呢？<br>当列表条目不足10个时，能出报表吗？<br>当列表空无一物时，能出报表吗？<br>当列表只有1个条目时，能出报表吗？<br>当列表条目不足10个时，能添加新条目吗？<br>当列表空无一物时，能添加新条目吗？<br>当列表只有1个条目时，能添加新条目吗？<br>要是菜单本身就没有10个条目，怎么办？<br>要是菜单中没有任何条目，又怎么办？<br>这些都是和数量相关的问题。在大多数情况下，你只需要考虑下列三种值：</p>
<ul>
<li>0</li>
<li>1</li>
<li>n ( n &gt; 1)<br>这称为<strong>0-1-n原则</strong>。</li>
</ul>
<ol>
<li>Time 时间性</li>
</ol>
<p>你需要始终记得以下这些与时间相关的方面：</p>
<ul>
<li>相对时间（时间上的顺序）</li>
<li>绝对时间（消耗的时间和钟表上的时刻）</li>
<li>并发问题</li>
</ul>
<p><strong>7.1 相对时间</strong><br>一些对象会有自己的内部状态。为了维护这些内部状态，你期望login()会在logout()之前被调用，prepareStatement()会在executeStatement()之前被调用，connect()在read()之前被调用，而read()又在close()之前被调用，等等。</p>
<p>你应该编写单元测试，测试如果这些顺序条件不满足时，工作单元的响应是否符合预期。例如，在没有调用login()之前执行logout()。如果你的设计意图是未login()之前执行logout()会抛出LogoutBeforeLoginException异常：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!loggedIn) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> LogoutBeforeLoginException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>那么你应该写这样的单元测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">assertThrows(LogoutBeforeLoginException.class, () -&gt; &#123;</span><br><span class="line">    instance.logout();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>相对时间还包括代码中的超时问题。你需要编写单元测试验证可能的超时出错问题。</p>
<p><strong>7.2 绝对时间</strong><br>与绝对时间/时刻相关的典型问题是这样一个问题。如果你在实现一个时间工具类。有一个静态方法是计算某个日期加若干个月之后是个什么日期：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LocalDate <span class="title">addMonths</span><span class="params">(LocalDate origDate, <span class="keyword">int</span> months)</span></span></span><br></pre></td></tr></table></figure><br>如果原始日期是2020年1月5日，我们期待这个方法加1个月后是2020年2月5日，加2个月后是2020年3月5日。但是如果原始日期是2020年1月30日，那么这个日期加1个月是个什么日期？2020年2月30日？没有这个日期！每年的2月一般只有20日，最长也只有29日。在这种情况下，我们必须首先定义好2020年1月30日加1个月是个什么日期，然后针对这个特殊点编写单元测试。</p>
<p><strong>7.3 并发问题</strong><br>时间带来的最棘手的问题是并发访问和同步访问的问题。在设计和编写代码的时候，要时刻询问自己：要是多个线程同时访问同一个对象，会出什么问题？然后针对这些可能的问题编写单元测试。</p>
<h2 id="好单元测试的特质"><a href="#好单元测试的特质" class="headerlink" title="好单元测试的特质"></a>好单元测试的特质</h2><p>好的单元测试应该具备下面的品质：<br>Automatic（自动化的）<br>Thorough（彻底的）<br>Repetable（可重复的）<br>Independent（独立的）<br>Professional（专业的）</p>
<ol>
<li>Automatic 自动化</li>
</ol>
<p>单元测试应该能够自动地运行，从准备数据到执行测试到检查结果这一整个过程都不需要人工干预。</p>
<p>首先，调用测试的过程必须是自动化的，不需要任何人工干预步骤，例如人工输入参数值或回答YES/NO。对于测试所需要的任何预设条件（例如创建一个临时文本文件并输入指定内容）等等，都应该成为单元测试自身的一个自动化组成部分。配合Maven这样的自动化构建工具，能够做到一键执行整个项目的全部单元测试并生成测试报告。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testConfig</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File file = File.createTempFile(<span class="string">&quot;app&quot;</span>, <span class="string">&quot;.conf&quot;</span>);</span><br><span class="line">    file.deleteOnExit();</span><br><span class="line">    BufferedWriter out = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(file));</span><br><span class="line">    out.write(<span class="string">&quot;charset=UTF-8&quot;</span>);</span><br><span class="line">    Configuration instance = Configuration.fromFileSystem(file);</span><br><span class="line">    assertThat(instance.getString(<span class="string">&quot;charset&quot;</span>)).isEqualTo(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子，为了测试用于读取配置文件的内容的Configuration类的getString()方法，必须首先存在一个包含确定内容的配置文件。我们不是在电脑上预先手工创建一个配置文件并填充内容，而是将创建文件和填充内容作为单元测试本身的一部分。这样的测试执行时就不需要人工干预了。</p>
<p>另一方面，检查测试结果也应该是自动化的，测试必须能够自己决定它是通过了还是失败了，而不需要人工确认。例如你要测试一个加密函数是否正确，你不应该让测试打印出加密结果，然后人工核对输出字符串和我们期望的加密后的字符串是否一样，而是由测试本身来断言二者是否相等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testEncrypt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String origStr = <span class="string">&quot;xxxx&quot;</span>;</span><br><span class="line">    String expectedStr = <span class="string">&quot;yyyy&quot;</span>;</span><br><span class="line">    Encryptor instance = <span class="keyword">new</span> Encryptor();</span><br><span class="line">    assertThat(instance.encrypt(origStr)).isEqualTo(expectedStr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Thorough 彻底</li>
</ol>
<p>好的单元测试应该覆盖了被测工作单元的每一个分支执行路径，每一个可能抛出的异常，甚至每一行代码（除了哪些getXXX()和setXXX()等极端简单，不包含逻辑的方法）。如果代码中有if…else…，你不能只是测试if这个分支，而不测试else这个分支。如果使用了switch语句，同样要测试到每一个case，以及最后的default。</p>
<ol>
<li>Repetable 可重复</li>
</ol>
<p>测试必须是可重复的，意味着：<br><strong>无论执行多少遍，结果都是一样的</strong><br>这意味着测试不会改变会影响它下一次运行的环境。例如一个测试往一个中央数据库插入一行数据，然后断言目前有多少行数据。这样的测试就是不可重复的，因为每次执行测试，记录行数都会加一。另外别人也可能向这个数据插入数据。解决办法是使用本地数据库（不共享），并且在每次测试之前清空数据。</p>
<p><strong>在任何人的电脑上执行，结果都是一样的</strong><br>这意味着测试不依赖于现有的计算机环境（操作系统，某个文件存在与否，等等）。不能只是“在我的笔记本上能够运通过测试”。</p>
<p><strong>在任何时间执行，结果都是一样的</strong><br>这意味着测试结果不受时间因素影响。如果被测代码的行为依赖于当前日期/时间（例如周末不能取款），那么在工作日和在周末执行取款测试，结果就可能不一样。这种情况下通常要重构产品代码，不要在方法内部通过<br>﻿<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Date now = <span class="keyword">new</span> Date();</span><br></pre></td></tr></table></figure><br>的方式获取当前时间，而是将时间作为一个参数传递给方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">withdraw</span><span class="params">(<span class="keyword">int</span> amount, Date withdrawTime)</span></span></span><br></pre></td></tr></table></figure><br>由客户代码负责获取当前时间并传递给Account.withdraw()方法。这样对withdraw()方法的单元测试又是可重复的了。</p>
<p>总之，单元测试的结果不受环境影响，也不受上次测试影响。无论如何，单元测试决不能依赖于共享资源（例如共享数据库或消息中间件），因为别人会操作这个资源，从而导致你的测试结果不确定。
﻿</p>
<ol>
<li>Independent 独立</li>
</ol>
<p>独立有两个含义：<br>一个测试只测试一件事情。<br>每个测试都有且只有一个关注点。</p>
<p>测试不依赖于其他测试。也就是说，多个测试之间没有顺序依赖。<br>一个测试不应该依赖于此前运行的另一个测试来为它设置测试条件（例如，第一个测试创建了文本文件并写入内容，第二个测试读取文件内容）。每个测试所需要的预设条件都应该在测试本身里面设置（第二个测试先创建文件，写入内容，再执行测试）。</p>
<ol>
<li>Professional 专业</li>
</ol>
<p>要按照编写产品代码的质量标准去编写测试代码。不要认为测试代码是二等公民，不值得为了提高它的质量而花费心力。在测试代码中，针对好设计的所有普遍规则——维护封装、采用DIY原则、降低耦合，等等等等，同样适用。</p>
<h2 id="TDD"><a href="#TDD" class="headerlink" title="TDD"></a>TDD</h2><p>TDD是Kent Beck开创的极限编程（Extreme Programming）这种敏捷方法论的核心实践之一。</p>
<blockquote>
<p>TDD的目标：Clean code that works</p>
</blockquote>
<p>极限编程、JUnit和TDD的创始人Kent Beck在他著名的《Test-Driven Development by Example》一书中，开宗明义地提出：<br>代码简洁可用（Clean code that works）这句言简意赅的话，正是 TDD 所追求的目标。</p>
<p><strong>为什么要测试先行</strong></p>
<ul>
<li>人性本懒。“后行”往往等于“没有”。</li>
<li>测试先行可以防止写出臃肿复杂难以测试的代码</li>
<li>测试用于表达需求、驱动设计，从测试工具变成分析设计工具</li>
</ul>
<p>这一点才是TDD真正的价值所在。测试先行迫使我们全面分析代码的功能目标以及在各种内外条件下的响应，并以测试的形式固化下来，达到以测试表达需求的结果。从这个角度来看，单元测试成了分析工具。</p>
<p>为了实现可测试性，我们的工作单元必须足够简单，代码行数少，局部变量少，分支路径少，没有或很少嵌套分支，依赖项目少，等等等等。为了能够隔离依赖进行测试，我们就要避免在工作单元内创建依赖项，而需要转变成依赖注入，并且使代码依赖于接口而不是实现类。以上种种，在满足可测试性的</p>
<p>压力下，程序员被迫优化了设计。从这个角度来看，单元测试又成了设计工具。</p>
<p>TDD的创始人Kent Beck说：</p>
<blockquote>
<p>测试驱动开发不是一种测试技术。它是一种分析技术、设计技术，更是一种组织所有开发活动的技术。</p>
</blockquote>
<p>因此，有人认为TDD不是Test-Driven Development（测试驱动开发），而是Test-Driven Design（测试驱动设计），强化它的设计工具特征，弱化它的测试工具特征。</p>
<p><strong>如何进行TDD</strong><br>TDD的基本步骤是所谓的<strong>红-绿-重构</strong>：<br><img src="https://i.loli.net/2021/02/22/aBWHrlv7jpMtbT6.png" alt="红绿重构.png"></p>
<ol>
<li>第一步：写一个测试并确保其失败。</li>
</ol>
<p>测试一定要在产品代码之前编写。在编写测试代码之前被测类及被测方法甚至可以尚未存在！我们可以借助IDE的帮助，由IDE协助我们创建被测对象和方法签名。如果不那么极端，也可以先创建被测产品类及被测方法的方法签名，但绝对不要写方法的实现内容。</p>
<p>要确保这个测试目前执行起来会失败！因为如果在没有代码实现的情况下测试成功了，就说明这是个不相关的测试，而这是不合理的！</p>
<ol>
<li>第二步：编写产品代码，刚好足够通过测试。</li>
</ol>
<p>在这一阶段，我们编写代码的唯一目的就是快速通过刚刚编写的单元测试。即使代码写得不好也无所谓。</p>
<ol>
<li>第三步：重构产品代码，改善其内部质量。</li>
</ol>
<p>在这一步就要运用各种设计和实现原则，重构代码，达到简洁的目标。<br>重构完成就再次运行单元测试。如果测试失败，就继续重构，直到最终通过测试。</p>
<ol>
<li>TDD的规则</li>
</ol>
<p>TDD有3条规则：</p>
<ul>
<li>除非是为了使一个失败的单元测试通过，否则不允许编写任何产品代码</li>
<li>在一个单元测试中，只允许编写刚好能够导致失败的内容</li>
<li>只允许编写刚好能够使一个失败的单元测试通过的产品代码</li>
</ul>
<p>第一条规则是为了防止产品代码无的放矢。产品代码这个矢的的只能是通过单元测试。如果没有单元测试在前面引导，你写的产品代码就是目标不明确的——它实现了什么？怎么证明它正确实现了？<br>第二条规则防止你盲目编写测试，或者编写一个太复杂的测试。<br>第三条规则是为了防止过度设计，或者加入了偏离了需求的内容。</p>
<h2 id="在项目中准备测试环境"><a href="#在项目中准备测试环境" class="headerlink" title="在项目中准备测试环境"></a>在项目中准备测试环境</h2><p>主要包括两个环节：：在项目中确定测试代码的存放位置；在项目中引入上述三大依赖。</p>
<p><strong>1.在项目中确定测试代码的存放位置</strong><br>测试代码和测试配置文件伴随产品代码的始终，同产品代码一起提交到版本库。<br>在Maven和Gradle项目中，测试代码应该放置在下面的目录：<br>src/test/java<br>而测试用到的资源文件（文本文件、jdbc配置文件、xml文件等等）应该放置在下面的目录：<br>src/test/resources<br>如果将测试代码和资源文件放到上述目录下，构建系统会自动找到测试代码并执行测试，不需要额外的配置。</p>
<p><strong>2.在项目中添加JUnit、AssertJ和Mockito三大依赖</strong><br>在pom.xml文件中添加下面的内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.platform<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-platform-launcher<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mockito<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mockito-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.assertj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>assertj-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.16.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        此处添加其他项目需要的依赖</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.platform<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-platform-launcher<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mockito<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mockito-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.assertj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>assertj-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      此处添加其他项目需要的依赖</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><br>通过定义dependencyManagement节，统一管理项目各个依赖项的版本和应用范围等等。这样在dependencies节中定义项目需要的依赖的时候就不再需要指定版本和应用范围。</p>
<p>记住这三大依赖都只用于测试，不是产品代码的一部分，因此它们的都是test而不是compile。因为默认scope就是compile，如果不将scope显式设定为test，最终产品中就可能会包含测试相关的各种类库(jar)，这是你所不希望的。</p>
<p>上面我们采用的是JUnit5，如果你还是习惯编写JUnit4或者3的单元测试，就还需要加上这么一个依赖项：junit-vintage-engine。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><br>另外，用于执行单元测试的surefire插件的版本也要用比较新的新本才能支持JUnit5：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.22.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                      其他插件</span></span><br><span class="line"><span class="comment">              --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">              其他内容</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><br><strong>在Gradle中添加JUnit、AssertJ和Mockito三大依赖</strong><br>在build.gradle文件中写下如下代码来支持运行 Junit Platform：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test &#123;</span><br><span class="line">  useJUnitPlatform()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>同时引入测试依赖：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">  testImplementation(<span class="string">&quot;org.junit.jupiter:junit-jupiter-api:5.6.2&quot;</span>)</span><br><span class="line">  testRuntimeOnly(<span class="string">&quot;org.junit.jupiter:junit-jupiter-engine:5.6.2&quot;</span>)</span><br><span class="line">  testCompile(<span class="string">&quot;org.mockito:mockito-core:3.3.3&quot;</span>)</span><br><span class="line">  testCompile(<span class="string">&quot;org.assertj:assertj-core:3.16.1&quot;</span>)</span><br><span class="line">  <span class="comment">//如果项目中包含JUnit4或3的测试，还需要加入下面一行</span></span><br><span class="line">  testRuntimeOnly(<span class="string">&quot;org.junit.vintage:junit-vintage-engine:5.6.2&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>3.测试类命名等相关建议</strong><br>有下面一些建议：<br><strong>测试类和被测类定义在相同的包里面。</strong><br>这主要是从方法可访问性的角度考虑的。我们不仅要测试被测类的public方法，有时可能还需要测试protected方法和包级私有的方法。如果测试类和被测类位于相同的包，测试类就可以访问以及测试被测类的protected和包级私有方法，否则可能没有办法测试这些方法。</p>
<p><strong>每个工作单元对应一个测试类。</strong><br>这意味着每个被测类对应多个测试类，而不是每个被测类对应一个测试类。<br>因为被测类往往有多个工作单元（非private方法），而每个工作单元往往需要编写一组单元测试。如果将对应一个被测类的单元测试都写在同一个测试类里面，会导致测试类很复杂，而且不够内聚，模糊了焦点。<br>单元测试关注的粒度是工作单元而不是类，所以应该基于工作单元来定义测试类。<br>如果针对一个工作单元的一组测试类的测试前准备和测试后清理工作差别比较大，也可以继续划分。</p>
<p><strong>测试类名以Test为后缀，最好也以被测类的类名和被测方法名为前缀。例如AccountWithdrawTest</strong><br>这样做一方面从可读性来说表现更好，另一方面可以方便构建系统根据命名模式筛选出真正的测试类。<br>在src/test/java目录中，除了测试类之外也可能包含一些辅助类、工具类。也可能存在测试基类，作为其他测试类的共同父类。这个时候制定测试类的命名模式就很重要了。下面是maven中的单元测试插件surefire的配置：它只选择了以Test为后缀，并且前缀不是Abstract和Base的类来执行测试：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*Test.java<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/Abstract*.java<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/Base*.java<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="JUnit"><a href="#JUnit" class="headerlink" title="JUnit"></a>JUnit</h2><blockquote>
<p>Never in the field of software development was so much owed by so many to so few lines of code. 软件开发史上从未有过如此少量的代码对如此广阔的领域产生了如此巨大的作用。 —Martin Fowler</p>
</blockquote>
<p>1997年，Eric Gamma（设计模式“四人帮”之一，Eclipse之父）和Kent Beck（极限编程方法学创始人）在从瑞士苏黎世飞往美国亚特兰大的飞机上偶遇，因为长路漫漫无心睡眠，两个人就进行结对编程，在下飞机之前完成了JUnit这个测试框架的第一个版本。此后，JUnit迅速传播，成为几乎每个Java项目的标配。</p>
<p><strong>1.JUnit 5的组成</strong><br>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</p>
<p>JUnit 5主要由三大部分组成：</p>
<ul>
<li>JUnit Platform：为在JVM上启动测试框架提供基础。它还定义了TestEngine API, 用来开发在平台上运行的测试框架。此外，该平台还提供了一个用于从命令行启动该平台的控制台启动器和一个基于JUnit 4的运行器，用于在基于JUnit 4的环境中在该平台上运行任何TestEngine。它也为流行的IDE（IntelliJ IDEA、Eclipse、NetBeans、Visual Studio Code等）和构建工具（Gradle、Maven、Ant等）提供了一级的支持。</li>
<li>JUnit Jupiter：是在JUnit 5中编写测试和扩展的新型编程模型[扩展模型的组合。Jupiter子项目提供了用于在平台上运行基于Jupiter的测试的TestEngine。</li>
<li>JUnit Vintage：提供用于在平台上运行基于JUnit 3和JUnit 4的测试的TestEngine。<br>如果我们不需要和JUnit版本3或者4兼容，就不需要JUnit Vintage。</li>
</ul>
<p><strong>2.测试类与测试方法</strong><br>`测试类<br>是同时符合下述条件的类：</p>
<ul>
<li>至少包含一个测试方法。</li>
<li>是顶层类、静态成员类或标记为@Nested的成员类。</li>
<li>不是抽象类。</li>
<li>不是private类。</li>
<li>只有一个构造函数</li>
</ul>
<p>`测试方法<br>是同时符合下述条件的方法：</p>
<ul>
<li>被标记或元标记为@Test,@RepeatedTest,@ParameterizedTest,@TestFactory, @TestTemplate之一。</li>
<li>是实例方法，不是静态方法。</li>
<li>不是抽象方法。</li>
<li>不是private方法。</li>
<li>没有返回值。</li>
<li>一般没有参数。特殊情况下有参数。</li>
<li>可以抛出任何异常。<br>测试类可以从超类或接口上继承测试方法。</li>
</ul>
<p><strong>3.测试实例生命周期</strong><br>JUnit测试实例生命周期有两种：<br><strong>PER_METHOD</strong><br>这是JUnit默认的生命周期。具体来说，就是在执行测试时为测试类中的每个测试方法单独创建测试类的实例，执行测试方法后销毁这个测试类实例，重新创建一个新的测试类实例来执行余下的测试方法。</p>
<p><strong>PER_CLASS</strong><br>在PER_CLASS模式下，JUnit在执行测试时创建一个测试类实例，在这个实例上执行所有的测试方法。</p>
<p>一般情况下应该采用采用PERMETHOD生命周期，因为它的隔离性更好。如果采用PERCLASS生命周期，一个测试的执行可能更改测试类的内部状态（修改了字段值），从而影响了后面的测试的先决条件。<br>PERCLASS模式比默认的PERMETHOD模式有一些额外的好处。具体来说，使用PER_CLASS模式，可以在非静态方法和接口默认方法上声明@BeforeAll和@AfterAll。因此，”per-class”模式也可以在@Nested测试类中使用@BeforeAll和@AfterAll方法。</p>
<p>要设定PER_CLASS生命周期，有两种可行方式：<br>对测试类加入@TestInstance(Lifecycle.PER_CLASS)注解。这种方式只影响当前测试类。</p>
<p>修改junit-platform.properties全局配置文件，加入下面的内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">junit.jupiter.testinstance.lifecycle.default = per_class</span><br></pre></td></tr></table></figure><br>﻿这种方式将影响整个测试计划中的所有测试类。<br>如果既有注解，又有全局配置，则以注解为优先。</p>
<p><strong>4.JUnit全局配置</strong><br>可以在测试类路径根目录下创建一个junit-platform.properties文本文件，用来定义JUnit平台的默认配置。在Maven和Gradle项目中，这个文件的位置通常是：<br>src/test/resources/junit-platform.properties</p>
<p><strong>5.注解（Annotations）</strong><br>JUnit是由Annotation驱动的。编写测试的时候，通常只需要使用JUnit定义的Annotation来标记测试类、方法、字段和参数，不需要继承JUnit特定的超类，也不需要实现JUnit特定的接口。多数情况下，也不需要使用JUnit定义的类和接口。</p>
<p>5.1 核心注解<br>JUnit Jupiter支持下列注解，用于配置测试和扩展框架。<br>除非特别说明，所有核心注解位于junit-jupiter-api模块中的org.junit.jupiter.api包中。<br><img src="https://i.loli.net/2021/02/22/Zf9SVFaku1W4Rpy.png" alt="JUnit核心注解.png"></p>
<p>5.2 元注解（Meta-Annotations）与组合注解（Composed Annotations）<br>JUnit的注解可以作为元注解使用，这意味着你可以定义自己的组合注解，它们自动继承它们的元注解的语义。</p>
<p>例如，您可以像下面那样创建一个名为@Fast的自定义组合注释，而不必在整个代码库（请参阅标签和过滤）中复制和粘贴@Tag(“fast”)。然后@Fast可以用作@Tag(“fast”)的一个替代品。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Tag;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Tag(&quot;fast&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Fast &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>下面的测试方法显示如何使用@Fast注解：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Fast</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myFastTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>标记了@Fast注解的测试方法，等价于标记了@Tag(“fast”)注解。</p>
<p>你甚至可以定义一个同时用@Tag(“fast”)和@Test注解的@FastTest组合注解，用来在测试方法中取代上述两个注解：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Tag;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Tag(&quot;fast&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FastTest &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>JUnit自动识别下面的测试方法为@Test和@Tag(“fast”)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FastTest</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myFastTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="JUnit编写简单测试"><a href="#JUnit编写简单测试" class="headerlink" title="JUnit编写简单测试"></a>JUnit编写简单测试</h3><p>我们从一个“简单测试”实例讲起。</p>
<p>在测试类中编写测试方法，一般将方法注解为@Test,@RepeatedTest,@ParameterizedTest,@TestFactory, @TestTemplate之一。我们从@Test开始。</p>
<p>绝大多数情况下，只需要用@Test定义测试方法，再加上4个生命周期方法@BeforeEach, @AfterEach, @BeforeAll和@AfterAll已经足够。<br>重要性：★★★★★<br>下面是一个测试类ConfigurationTest，包含了两个测试方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.io.TempDir;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.assertThat;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigurationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TempDir</span></span><br><span class="line">    Path tempDir;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key存在,value存在,应当返回value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_string_without_defaultValue_happy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Path file = tempDir.resolve(<span class="string">&quot;conf.properties&quot;</span>);</span><br><span class="line">        Files.write(file, Arrays.asList(<span class="string">&quot;birthday=2002-05-11&quot;</span>,</span><br><span class="line">                <span class="string">&quot;size=15&quot;</span>,</span><br><span class="line">                <span class="string">&quot;closed=true&quot;</span>,</span><br><span class="line">                <span class="string">&quot;locked=false&quot;</span>,</span><br><span class="line">                <span class="string">&quot;salary=12.5&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name=张三&quot;</span>,</span><br><span class="line">                <span class="string">&quot;noneValue=&quot;</span>));</span><br><span class="line">        Configuration instance = Configuration.builder()</span><br><span class="line">                .fromFile(file.toFile())</span><br><span class="line">                .dateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        assertThat(instance.getString(<span class="string">&quot;name&quot;</span>)).isEqualTo(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key存在, value存在,格式正确,应当返回value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_int_with_defaultValue_and_with_value</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Path file = tempDir.resolve(<span class="string">&quot;conf.properties&quot;</span>);</span><br><span class="line">        Files.write(file, Arrays.asList(<span class="string">&quot;birthday=2002-05-11&quot;</span>,</span><br><span class="line">                <span class="string">&quot;size=15&quot;</span>,</span><br><span class="line">                <span class="string">&quot;closed=true&quot;</span>,</span><br><span class="line">                <span class="string">&quot;locked=false&quot;</span>,</span><br><span class="line">                <span class="string">&quot;salary=12.5&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name=张三&quot;</span>,</span><br><span class="line">                <span class="string">&quot;noneValue=&quot;</span>));</span><br><span class="line">        Configuration instance = Configuration.builder()</span><br><span class="line">                .fromFile(file.toFile())</span><br><span class="line">                .dateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        assertThat(instance.getInt(<span class="string">&quot;size&quot;</span>, <span class="number">1000</span>)).isEqualTo(<span class="number">15</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>说明如下：</p>
<p>被注解为@Test的方法是测试方法。这里有两个测试方法：get_string_without_defaultValue_happy()和get_int_with_defaultValue_and_with_value()。</p>
<p>因为拥有测试方法，这个类就自动成为了测试类，会被Eclipse、IDEA等IDE和Maven、Gradle等构建工具自动识别，执行测试。</p>
<p>这个测试类用于测试被测类Configuration。Configuration能够从文本配置文件中读取配置项的值。</p>
<p>通过@TempDir注解创建了一个临时目录。在两个测试方法中，都会在这个临时目录下创建conf.properties文件，并向其中写入多行配置数据。从这个配置文件创建被测类Configuration的实例，进行测试。</p>
<p>可以见到，两个测试方法之间拥有大量的重复代码。用于创建被测类实例和准备测试数据。</p>
<h3 id="生命周期方法"><a href="#生命周期方法" class="headerlink" title="生命周期方法"></a>生命周期方法</h3><p>重要性：★★★★★<br>XUnit测试模式中有一个四阶段测试模式setup - exercise - verify - teardown：</p>
<ol>
<li>测试准备（fixture setup）阶段</li>
</ol>
<p>在这个阶段中，准备测试所依赖的外部环境（例如被测类要读写文件，就先在文件系统中创建这个文件，必要时还写入特定的内容），创建被测类（System Under Test，简称SUT）的实例，设置被测类的内部状态，注入它的外部依赖（一般用测试替身替代），等等等等。一句话：为测试的执行满足各种内外条件，使被测系统（SUT）和环境达到一个确定的状态（称为Fixture）。</p>
<ol>
<li>执行测试（exercise SUT）阶段</li>
</ol>
<p>在这个阶段中，我们与被测类（SUT）交互，执行测试。</p>
<ol>
<li>结果验证（result verification）阶段</li>
</ol>
<p>在这个阶段，我们验证测试的结果是否符合方方面面的预期：方法的返回值是否和我们的期望值相同？SUT的内部状态是否更新到我们期望的值？是否向文件或数据库写入了预期的数据？是否按照契约调用了外部依赖的指定方法？等等。</p>
<ol>
<li>环境清理（fixture teardown）阶段</li>
</ol>
<p>在这个阶段将系统和环境恢复到测试前的状态——测试不应该对系统和环境造成持久性的改变。这包括：从数据库中删除测试插入的数据，从文件系统删除测试创建的文件，将修改了的数据行恢复原状，等等。<br>﻿<br>存在于同一个测试类中的多个测试方法，在setup和teardown阶段往往有重复的内容。例如上一节的例子，两个测试方法在setup阶段存在下面的重复代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Path file = tempDir.resolve(<span class="string">&quot;conf.properties&quot;</span>);</span><br><span class="line">Files.write(file, Arrays.asList(<span class="string">&quot;birthday=2002-05-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size=15&quot;</span>,</span><br><span class="line">        <span class="string">&quot;closed=true&quot;</span>,</span><br><span class="line">        <span class="string">&quot;locked=false&quot;</span>,</span><br><span class="line">        <span class="string">&quot;salary=12.5&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name=张三&quot;</span>,</span><br><span class="line">        <span class="string">&quot;noneValue=&quot;</span>));</span><br><span class="line">Configuration instance = Configuration.builder()</span><br><span class="line">        .fromFile(file.toFile())</span><br><span class="line">        .dateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure><br>JUnit提供了4个生命周期方法，帮助我们消除setup和teardown阶段的重复代码。<br>所有生命周期方法都应该满足以下条件：</p>
<ul>
<li>不是private的方法</li>
<li>返回void</li>
<li>一般也没有参数（一些特殊情况除外）</li>
<li>可以抛出任何异常</li>
</ul>
<p><strong>@BeforeEach和@AfterEach</strong><br>这两个注解标识在测试类的实例方法上。分别用在四阶段测试setup-exercise-verify-teardown的setup阶段和teardown阶段上。<br>标识为@BeforeEach的方法，会在测试类中的每个测试方法执行之前执行一次。标识为@AfterEach的方法，会在测试类中的每个测试方法执行之后执行一次。<br>上一节的测试类可以用BeforeEach和AfterEach改写为这个样子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.io.TempDir;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.assertThat;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Configuration3Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TempDir</span></span><br><span class="line">    Path tempDir;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Configuration instance;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Path file = tempDir.resolve(<span class="string">&quot;conf.properties&quot;</span>);</span><br><span class="line">        Files.write(file, Arrays.asList(<span class="string">&quot;birthday=2002-05-11&quot;</span>,</span><br><span class="line">                <span class="string">&quot;size=15&quot;</span>,</span><br><span class="line">                <span class="string">&quot;closed=true&quot;</span>,</span><br><span class="line">                <span class="string">&quot;locked = false&quot;</span>,</span><br><span class="line">                <span class="string">&quot;salary=12.5&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name=张三&quot;</span>,</span><br><span class="line">                <span class="string">&quot;noneValue=&quot;</span>));</span><br><span class="line">        instance = Configuration.builder()</span><br><span class="line">                .fromFile(file.toFile())</span><br><span class="line">                .dateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Noting to do for now.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key存在,value存在,应当返回value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_string_without_defaultValue_happy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        assertThat(instance.getString(<span class="string">&quot;name&quot;</span>)).isEqualTo(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key存在, value存在,格式正确,应当返回value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_int_with_defaultValue_and_with_value</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        assertThat(instance.getInt(<span class="string">&quot;size&quot;</span>, <span class="number">1000</span>)).isEqualTo(<span class="number">15</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>通过将共同的setup代码提取到@BeforeEach生命周期方法，减少了重复代码。</p>
<p>当我们采用了PER_CLASS生命周期时，会为每个测试方法实例化一个新的测试类，然后在这个测试类实例上依次调用@BeforeEach生命周期方法、测试方法和@AfterEach生命周期方法。</p>
<p>如果我们采用了PER_CLASS生命周期，则不会为每个测试方法分别创建一个新的测试类实例，而是共同同一个测试类实例，但是依然会在每个测试方法的前后执行一次@BeforeEach和@AfterEach生命周期方法。</p>
<p><strong>@BeforeAll和@AfterAll</strong><br>标识为@BeforeAll和@AfterAll的生命周期方法，会在每个测试类执行之前/后运行一次。不过测试类中有多少个测试方法，这两个方法都只在类级范围内运行一次。</p>
<p>如果我们采用PERMETHOD生命周期，@BeforeAll和@AfterAll只能标识测试类内的静态方法（从而只能操作测试类内的静态字段）。如果采用PERCLASS生命周期，这两个方法可以标识在测试类的实例方法上。</p>
<p>下面是代码示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.fail;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumeTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterAll;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeAll;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Disabled;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StandardTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">succeedingTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">failingTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        fail(<span class="string">&quot;a failing test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Disabled(&quot;for demonstration purposes&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">skippedTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// not executed</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">abortedTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assumeTrue(<span class="string">&quot;abc&quot;</span>.contains(<span class="string">&quot;Z&quot;</span>));</span><br><span class="line">        fail(<span class="string">&quot;test should have been aborted&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>测试时方法的调用顺序是：<br>initAll()<br>init()<br>测试方法（succeedingTest()、failingTest()、abortedTest()三个方法之一。不确定先跑哪个）<br>tearDown()<br>init()<br>测试方法（succeedingTest()、failingTest()、abortedTest()三个方法之一。不确定先跑哪个）<br>tearDown()<br>init()<br>测试方法（succeedingTest()、failingTest()、abortedTest()三个方法之一。不确定先跑哪个）<br>tearDown()<br>tearDownAll()</p>
<p><strong>在测试的setup阶段应该用@BeforeEach还是@BeforeAll</strong><br>一般而言，应该尽量使用@BeforeEach生命周期方法，因为它的隔离性更好，使得同一个测试类中的多个测试方法不会相互影响。只有在setup代码资源消耗太大、性能太低的情况下才考虑使用@BeforeAll代替@BeforeEach生命周期方法。在使用@BeforeAll时，一定要细心审查你的测试代码，确保一个测试的执行不会对另一个测试造成的显著影响。</p>
<p>@BeforeAll一般只用于集成测试。因为集成测试的setup阶段往往需要启动数据库或应用服务器等，资源消耗比较大。</p>
<p><strong>生命周期方法的继承关系</strong><br>如果测试类所继承的超类或实现的接口中也定义了生命周期方法（Java 8之后允许在接口上定义缺省方法，缺省方法伴中可以包含代码），而测试类自身也定义了生命周期方法，当超类和接口中的生命周期方法没有被测试类隐藏（hidden）或覆盖（overridden）时，接口、超类和测试类本身的生命</p>
<p>周期方法都会执行，而且：</p>
<ul>
<li>接口中定义的@BeforeAll和@BeforeEach生命周期方法会在实现类的相应生命周期方法之前执行；</li>
<li>超类中定义的@BeforeAll和@BeforeEach生命周期方法会在子类的相应生命周期方法之前执行；</li>
<li>接口中定义的@AfterAll和@AfterEach生命周期方法会在实现类的相应生命周期方法之后执行；</li>
<li>超类中定义的@AfterAll和@AfterEach生命周期方法会在子类的相应生命周期方法之后执行。<br>如果有接口I，超类A和子类S，都定义了四个生命周期方法而且不相互覆盖/重载：<br>如果A实现I，S继承A：<br>（1）对于@BeforeAll和@BeforeEach生命周期方法，执行顺序是：<br>接口上的方法 &gt; 超类上的方法 &gt; 子类上的方法<br>（2）对于@AfterAll和@AfterEach生命周期方法，执行顺序是：<br>子类上的方法 &gt; 超类上的方法 &gt; 接口上的方法<br>如果S继承A，同时实现I：<br>（1）对于@BeforeAll和@BeforeEach生命周期方法，执行顺序是：<br>超类上的方法 &gt; 接口上的方法 &gt; 子类上的方法<br>（2）对于@AfterAll和@AfterEach生命周期方法，执行顺序是：<br>子类上的方法 &gt; 接口上的方法 &gt; 超类上的方法</li>
</ul>
<p><strong>代码示例</strong><br>首先，我们定一个一个接口TheInterface：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> luobogan.top.tdd.lifecycle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TheInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Before Each In Interface&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">beforeEachInInterface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before Each In Interface&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;After Each In Interface&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">afterEachInInterface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After Each In Interface&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Before All In Interface&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beforeAllInInterface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before All In Interface&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;After All In Interface&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">afterAllInInterface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After All In Interface&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>然后再定义一个抽象基类TheSuperClass，它实现了TheInterface接口：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> luobogan.top.tdd.lifecycle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TheSuperClass</span> <span class="keyword">implements</span> <span class="title">TheInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Before Each In Superclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">beforeEachInSuperclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before Each In Superclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;After Each In Superclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">afterEachInSuperclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After Each In Superclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Before All In Superclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beforeAllInSuperclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before All In Superclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;After All In Superclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">afterAllInSuperclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After All In Superclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>最后定义测试类TheSubClass，它继承TheSuperClass并定义了两个测试方法aTest()和<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> luobogan.top.tdd.lifecycle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TheSubClass</span> <span class="keyword">extends</span> <span class="title">TheSuperClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Before Each In Subclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">beforeEachInSubclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before Each In Subclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;After Each In Subclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">afterEachInSubclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After Each In Subclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Before All In Subclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beforeAllInSubclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before All In Subclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;After All In Subclass&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">afterAllInSubclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After All In Subclass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;A Test Method&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">aTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A Test Method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Another Test Method&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">anotherTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Another Test Method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>三个类中都定义了四个生命周期方法。对TheSubClass类执行单元测试，控制台输出如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Before All In Interface</span><br><span class="line">Before All In Superclass</span><br><span class="line">Before All In Subclass</span><br><span class="line"></span><br><span class="line">Before Each In Interface</span><br><span class="line">Before Each In Superclass</span><br><span class="line">Before Each In Subclass</span><br><span class="line">Another Test Method</span><br><span class="line">After Each In Subclass</span><br><span class="line">After Each In Superclass</span><br><span class="line">After Each In Interface</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Before Each In Interface</span><br><span class="line">Before Each In Superclass</span><br><span class="line">Before Each In Subclass</span><br><span class="line">A Test Method</span><br><span class="line">After Each In Subclass</span><br><span class="line">After Each In Superclass</span><br><span class="line">After Each In Interface</span><br><span class="line"></span><br><span class="line">After All In Subclass</span><br><span class="line">After All In Superclass</span><br><span class="line">After All In Interface</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><br>上面的测试结果证明了：<br>@BeforeAll方法在每个测试类之前执行一次，@AfterAll方法在每个测试类之后执行一次。<br>@BeforeEach方法在每个测试方法之前执行一次，@AfterEach方法在每个测试方法之后执行一次。</p>
<p>如果测试类继承了超类或实现了接口，而后者也定义了生命周期方法并且没有被测试类隐藏或覆盖，则超类或接口上定义的生命周期方法也会执行，其顺序与继承或实现的层级相关。对于@BeforeAll和@BeforeEach方法，是先执行接口和超类上的方法再执行子类上的方法；对于@AfterAll和@AfterEach方法，是先执行子类上的方法再执行接口和超类上的方法。</p>
<h3 id="显示名"><a href="#显示名" class="headerlink" title="显示名"></a>显示名</h3><p>重要性：★★★☆☆<br>可以通过@DisplayName注解给测试类和测试方法自定义名称。<br>显示名中可以包含空格、特殊字符甚至表情符号等。显示名可以出现在测试报告、测试运行器和IDE中，增强可读性。<br>下面是代码例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DisplayName(&quot;A special test case&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisplayNameDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Custom test name containing spaces&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testWithDisplayNameContainingSpaces</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;╯°□°）╯&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testWithDisplayNameContainingSpecialCharacters</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;😱&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testWithDisplayNameContainingEmoji</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>1.显示名生成器</strong><br>JUnit允许创建定制的显示名生成器，通过<code>@DisplayNameGeneration</code>注解来进行配置。如果<code>@DisplayName</code>和<code>@DisplayNameGeneration</code>同时存在，前者更优先。<br>下面是代码例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayNameGeneration;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayNameGenerator;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Nested;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.ParameterizedTest;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.provider.ValueSource;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisplayNameGeneratorDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A_year_is_not_supported</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">if_it_is_zero</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@DisplayName(&quot;A negative value for year is not supported by the leap year computation.&quot;)</span></span><br><span class="line">        <span class="meta">@ParameterizedTest(name = &quot;For example, year &#123;0&#125; is not supported.&quot;)</span></span><br><span class="line">        <span class="meta">@ValueSource(ints = &#123; -1, -4 &#125;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">if_it_is_negative</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayNameGeneration(IndicativeSentences.class)</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A_year_is_a_leap_year</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">if_it_is_divisible_by_4_but_not_by_100</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ParameterizedTest(name = &quot;Year &#123;0&#125; is a leap year.&quot;)</span></span><br><span class="line">        <span class="meta">@ValueSource(ints = &#123; 2016, 2020, 2048 &#125;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">if_it_is_one_of_the_following_years</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IndicativeSentences</span> <span class="keyword">extends</span> <span class="title">DisplayNameGenerator</span>.<span class="title">ReplaceUnderscores</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">generateDisplayNameForClass</span><span class="params">(Class&lt;?&gt; testClass)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.generateDisplayNameForClass(testClass);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">generateDisplayNameForNestedClass</span><span class="params">(Class&lt;?&gt; nestedClass)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.generateDisplayNameForNestedClass(nestedClass) + <span class="string">&quot;...&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">generateDisplayNameForMethod</span><span class="params">(Class&lt;?&gt; testClass, Method testMethod)</span> </span>&#123;</span><br><span class="line">            String name = testClass.getSimpleName() + <span class="string">&#x27; &#x27;</span> + testMethod.getName();</span><br><span class="line">            <span class="keyword">return</span> name.replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27; &#x27;</span>) + <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-- DisplayNameGeneratorDemo [OK]</span><br><span class="line">  +-- A year is not supported [OK]</span><br><span class="line">  | +-- A negative value for year is not supported by the leap year computation. [OK]</span><br><span class="line">  | | +-- For example, year -1 is not supported. [OK]</span><br><span class="line">  | | &#x27;-- For example, year -4 is not supported. [OK]</span><br><span class="line">  | &#x27;-- if it is zero() [OK]</span><br><span class="line">  &#x27;-- A year is a leap year... [OK]</span><br><span class="line">    +-- A year is a leap year if it is divisible by 4 but not by 100. [OK]</span><br><span class="line">    &#x27;-- A year is a leap year if it is one of the following years. [OK]</span><br><span class="line">      +-- Year 2016 is a leap year. [OK]</span><br><span class="line">      +-- Year 2020 is a leap year. [OK]</span><br><span class="line">      &#x27;-- Year 2048 is a leap year. [OK]</span><br></pre></td></tr></table></figure><br><strong>2.设置缺省的显示名生成器</strong><br>可以在JUnit平台配置文件junit-platform.properties中设置缺省的显示名生成器：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">junit.jupiter.displayname.generator.default = \</span><br><span class="line">    org.junit.jupiter.api.DisplayNameGenerator$ReplaceUnderscores</span><br></pre></td></tr></table></figure><br>所有的显示名生成器都要实现DisplayNameGenerator接口。<br>测试类和测试方法中的显示名按照下面的优先规则确定：</p>
<ul>
<li>@DisplayName注解的值，如果存在的话；</li>
<li>通过调用@DisplayNameGeneration注解中定义的DisplayNameGenerator，如果存在的话；</li>
<li>通过调用平台配置文件junit-platform.properties中设置缺省的显示名生成器，如果存在的话；</li>
<li>通过调用org.junit.jupiter.api.DisplayNameGenerator.Standard显示名生成器。</li>
</ul>
<h3 id="断言、假设、使测试生效"><a href="#断言、假设、使测试生效" class="headerlink" title="断言、假设、使测试生效"></a>断言、假设、使测试生效</h3><p><strong>断言</strong><br>重要性：★☆☆☆☆<br>在四阶段测试模式的verify阶段，我们通过各种断言证明测试的结果——方法的返回值、SUT状态的变更、对外部依赖类的调用、对数据库、文件系统造成的变更、抛出的异常等等——符合我们的预期。例如断言被测试的加法器计算2 + 2的结果是4。</p>
<p>JUnit Jupiter本身定义了大量的断言，全部以org.junit.jupiter.api.Assertions类上的静态方法的形式存在，如assertEquals、assertTrue、assertFalse、assertNull、assertNotNull、assertThrows、assertTimeout、assertTimeoutPreemptively等等。</p>
<p>但是在单元测试领域有很多更加好用的断言库，其中最有名的是AssertJ，建议直接使用AssertJ，放弃JUnit Jupiter自带的断言。<br>﻿<br><strong>假设（Assumptions）</strong><br>重要性：★★★☆☆<br>从JUnit 4开始在测试中支持假设Assumptions。JUnit Jupiter的假设都是org.junit.jupiter.api.Assumptions类的静态方法。</p>
<p>当假设assumption失败时，余下的测试内容会终止执行，测试被标识为aborted状态（而不是失败failed），直接终止。与断言失败不同，当断言assertion失败时，测试会被认定为失败failed状态。</p>
<p>假设的典型应用场景是：当一个测试方法继续执行没有意义的时候——例如，测试所依赖的环境条件不满足时——终止测试的继续执行。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumeTrue;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumingThat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> example.util.Calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssumptionsDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testOnlyOnCiServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assumeTrue(<span class="string">&quot;CI&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)));</span><br><span class="line">        <span class="comment">// remainder of test</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testOnlyOnDeveloperWorkstation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assumeTrue(<span class="string">&quot;DEV&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)),</span><br><span class="line">            () -&gt; <span class="string">&quot;Aborting test: not on developer workstation&quot;</span>);</span><br><span class="line">        <span class="comment">// remainder of test</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testInAllEnvironments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assumingThat(<span class="string">&quot;CI&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)),</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                <span class="comment">// perform these assertions only on the CI server</span></span><br><span class="line">                assertEquals(<span class="number">2</span>, calculator.divide(<span class="number">4</span>, <span class="number">2</span>));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// perform these assertions in all environments</span></span><br><span class="line">        assertEquals(<span class="number">42</span>, calculator.multiply(<span class="number">6</span>, <span class="number">7</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>使测试失效</strong><br>重要性：★★★★☆<br>通过@Disabled注解使测试临时失效。测试方法被直接忽略，不再参与测试执行。<br>@Disabled可以注解在测试类上，也可以注解在测试方法上。如果注解在测试类上，整个测试类都将被忽略。如果注解在测试方法上，只有这个测试方法会被忽略掉。<br>下面是代码示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Disabled;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisabledTestsDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Disabled(&quot;Disabled until bug #42 has been resolved&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testWillBeSkipped</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testWillBeExecuted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>在添加@Disabled注解时最好像上面代码示例一样，提供失效这个测试的理由。</p>
<h3 id="有条件执行测试"><a href="#有条件执行测试" class="headerlink" title="有条件执行测试"></a>有条件执行测试</h3><p>重要性：★★★☆☆<br>JUnit Jupiter通过ExecutionCondition扩展API允许开发者根据各种条件编程式地生效或失效某些测试。最简单的条件执行例子是通过内建的DisabledCondition支持@Disabled注解。除了@Disabled之外，JUnit Jupiter还在org.junit.jupiter.api.condition包中提供了一些基于注解的执行条件，开发人员可以使用它们来声明式地生效或失效测试或测试容器（测试类等）。</p>
<p>如果注册了多个ExecutionCondition，只要其中任何一个条件返回了disabled，测试或测试容器就会被失效掉。<br>下文将要介绍的这些条件注解也可以作为元注解用来创建定制的组合注解。<br>下文将要介绍的所有条件注解，都可以用来注解测试方法、测试类和测试接口。</p>
<p>除非特别说明，下面介绍的每一个条件注解在一个测试接口、测试类或测试方法中只能声明一次。如果同一个条件注解（不论起属性值是否相同）直接、间接或以元注解的方式在一个给定的元素（测试方法、测试类、测试接口）上多次出现，JUnit将只使用它遇到的第一个注解，其他的同种条件注解将被默默地忽略掉。但是，每个条件注解都可以和org.junit.jupiter.api.condition包中的其它条件注解联合使用。</p>
<p>﻿例如，在下面的测试方法onlyOnMacOs()中，注解@EnabledOnOs出现了两次，虽然它们的值不同，但最终只有其中一个会起作用，最终只有两个有效注解生效：@EnabledOnOs(MAC)和@EnabledOnJre(JAVA_8)，@EnabledOnOs(LINUX)注解被直接忽略掉了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@EnabledOnOs(MAC)</span></span><br><span class="line"><span class="meta">@EnabledOnOs(LINUX)</span></span><br><span class="line"><span class="meta">@EnabledOnJre(JAVA_8)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onlyOnMacOs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>1.操作系统条件</strong><br>根据测试执行时所处的操作系统生效/失效测试。<br>有两个和操作系统相关的注解：@EnabledOnOs在操作系统符合条件时生效测试，@DisabledOnOs在操作系统符合条件时失效测试。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.conditions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.DisabledOnOs;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.EnabledOnOs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.condition.OS.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OsCondition</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledOnOs(MAC)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onlyOnMacOs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Mac&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TestOnMac</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testOnMac</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Mac&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledOnOs(&#123; LINUX, MAC &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onLinuxOrMac</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Linux or Mac&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledOnOs(WINDOWS)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notOnWindows</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Not Run on Windows&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledOnOs(MAC)</span></span><br><span class="line">    <span class="meta">@interface</span> TestOnMac &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>上面的示例代码中，我们还定义了一个组合条件注解@TestOnMac。</p>
<p><strong>2.Java版本条件</strong><br>根据测试执行时的Java运行时版本生效/失效测试。相关的注解可分为两组：<br>@EnabledOnJre和@DisabledOnJre在Java版本等于指定的版本号时生效或失效测试；<br>@EnabledForJreRange 和 @DisabledForJreRange 在Java版本处于指定的版本范围时生效或失效测试。范围的缺省下限是JRE.JAVA_8，缺省上限是JRE.OTHER，允许使用半开区间，即可以只指定min和max其中之一。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.conditions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.DisabledForJreRange;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.DisabledOnJre;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.EnabledForJreRange;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.EnabledOnJre;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.condition.JRE.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaCondition</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledOnJre(JAVA_8)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onlyOnJava8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java 8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledOnJre(&#123; JAVA_9, JAVA_10 &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onJava9Or10</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java 9 or 10&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledForJreRange(min = JAVA_9, max = JAVA_11)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fromJava9to11</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java 9 to 11&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledForJreRange(min = JAVA_9)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fromJava9toCurrentJavaFeatureNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java 9 or above&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledForJreRange(max = JAVA_11)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fromJava8To11</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java 11 or below&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledOnJre(JAVA_9)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notOnJava9</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java not 9&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledForJreRange(min = JAVA_9, max = JAVA_11)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notFromJava9to11</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java not between 9 to 11&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledForJreRange(min = JAVA_9)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notFromJava9toCurrentJavaFeatureNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java not above 9&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledForJreRange(max = JAVA_11)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notFromJava8to11</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run on Java not below 11&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>3.系统属性条件</strong><br>根据测试执行时的JVM的系统属性值生效或失效测试。</p>
<p>﻿有两个和系统属性相关的条件注解：@EnabledIfSystemProperty和@DisabledIfSystemProperty。这些注解有两个属性：named属性和matches属性，其中matches属性是一个正则表达式。如果存在named属性指定的属性名并且属性值与matches属性匹配，则分别生效/失效这两个注解所标识的测试方法、测试类或测试接口。<br>﻿<br>这两个注解都是可重复的，意味着可以在同一个元素（测试方法、测试类、测试接口等）上多次声明@EnabledIfSystemProperty和@DisabledIfSystemProperty注解（注解的属性值可以相同，也可以不同）。这些注解可以直接、间接存在，或者以元注解的方式存在。<br>﻿除此以外还有两个注解@EnabledIfSystemProperties和@DisabledIfSystemProperties，分别用于组合多个@EnabledIfSystemProperty和@DisabledIfSystemProperty注解。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.conditions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysPropCondition</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfSystemProperty(named = &quot;os.arch&quot;, matches = &quot;.*64.*&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onlyOn64BitArchitectures</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledIfSystemProperty(named = &quot;ci-server&quot;, matches = &quot;true&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notOnCiServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfSystemProperties(&#123;</span></span><br><span class="line"><span class="meta">            @EnabledIfSystemProperty(named = &quot;os.arch&quot;, matches = &quot;.*64.*&quot;),</span></span><br><span class="line"><span class="meta">            @EnabledIfSystemProperty(named = &quot;ci-server&quot;, matches = &quot;true&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">multiEnabledIfSystemProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfSystemProperty(named = &quot;os.arch&quot;, matches = &quot;.*64.*&quot;)</span></span><br><span class="line">    <span class="meta">@EnabledIfSystemProperty(named = &quot;ci-server&quot;, matches = &quot;true&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">multiEnabledIfSystemProperties2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledIfSystemProperties(&#123;</span></span><br><span class="line"><span class="meta">            @DisabledIfSystemProperty(named = &quot;os.arch&quot;, matches = &quot;.*64.*&quot;),</span></span><br><span class="line"><span class="meta">            @DisabledIfSystemProperty(named = &quot;ci-server&quot;, matches = &quot;true&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">multiDisabledIfSystemProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledIfSystemProperty(named = &quot;os.arch&quot;, matches = &quot;.*64.*&quot;)</span></span><br><span class="line">    <span class="meta">@DisabledIfSystemProperty(named = &quot;ci-server&quot;, matches = &quot;true&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">multiDisabledIfSystemProperties2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfOsArch64</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onlyOn64BitArchitectures2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@EnabledIfSystemProperty(named = &quot;os.arch&quot;, matches = &quot;.*64.*&quot;)</span></span><br><span class="line">    <span class="meta">@interface</span> EnabledIfOsArch64 &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>4.环境变量条件</strong><br>根据环境变量的值生效/失效测试。<br>有两个和环境变量相关的注解：@EnabledIfEnvironmentVariable和@DisabledIfEnvironmentVariable注解。这些注解有两个属性：named属性和matches属性，其中matches属性是一个正则表达式。如果存在named属性指定的环境变量名名并且环境变量值与matches属性匹配，则生效/失效这两个注解所标识的测试方法、测试类或测试接口。</p>
<p>这两个注解都是可重复的，意味着可以在同一个元素（测试方法、测试类、测试接口等）上多次声明@EnabledIfEnvironmentVariable和@DisabledIfEnvironmentVariable注解（注解的属性值可以相同，也可以不同）。这些注解可以直接、间接存在，或者以元注解的方式存在。<br>除此以外还有两个注解@EnabledIfEnvironmentVariables和@DisabledIfEnvironmentVariables，分别用于组合多个@EnabledIfEnvironmentVariable和@DisabledIfEnvironmentVariable注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.conditions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.condition.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnvVariableCondition</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfEnvironmentVariable(named = &quot;ENV&quot;, matches = &quot;staging-server&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onlyOnStagingServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledIfEnvironmentVariable(named = &quot;ENV&quot;, matches = &quot;.*development.*&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notOnDeveloperWorkstation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfEnvironmentVariables(&#123;</span></span><br><span class="line"><span class="meta">            @EnabledIfEnvironmentVariable(named = &quot;ENV&quot;, matches = &quot;staging-server&quot;),</span></span><br><span class="line"><span class="meta">            @EnabledIfEnvironmentVariable(named = &quot;DB&quot;, matches = &quot;mysql&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enableMultiEnvironmentVariables</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfEnvironmentVariable(named = &quot;ENV&quot;, matches = &quot;staging-server&quot;)</span></span><br><span class="line">    <span class="meta">@EnabledIfEnvironmentVariable(named = &quot;DB&quot;, matches = &quot;mysql&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enableMultiEnvironmentVariables2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledIfEnvironmentVariables(&#123;</span></span><br><span class="line"><span class="meta">            @DisabledIfEnvironmentVariable(named = &quot;ENV&quot;, matches = &quot;staging-server&quot;),</span></span><br><span class="line"><span class="meta">            @DisabledIfEnvironmentVariable(named = &quot;DB&quot;, matches = &quot;mysql&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">disableMultiEnvironmentVariables</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisabledIfEnvironmentVariable(named = &quot;ENV&quot;, matches = &quot;staging-server&quot;)</span></span><br><span class="line">    <span class="meta">@DisabledIfEnvironmentVariable(named = &quot;DB&quot;, matches = &quot;mysql&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">disableMultiEnvironmentVariables2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@EnabledIfDevEnv</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onlyOnDevEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@EnabledIfEnvironmentVariable(named = &quot;ENV&quot;, matches = &quot;dev&quot;)</span></span><br><span class="line">    <span class="meta">@interface</span> EnabledIfDevEnv &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><p>重要性：★★★★☆<br>测试类和测试方法可以用@Tag注解打标签，这些标签随后可用于在测试发现和执行中作为测试筛选条件。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.tags;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Tag;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Tags;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Tag(&quot;fast&quot;)</span></span><br><span class="line"><span class="meta">@Tag(&quot;model&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TagDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Tag(&quot;taxes&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testingTaxCalculation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@IntegrationTest</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">aIntegrationTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Tags( &#123;</span></span><br><span class="line"><span class="meta">            @Tag(&quot;fast&quot;),</span></span><br><span class="line"><span class="meta">            @Tag(&quot;model&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testWithTags</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@Tag(&quot;IntegrationTest&quot;)</span></span><br><span class="line">    <span class="meta">@interface</span> IntegrationTest &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>可以对同一个测试方法或测试类多次声明@Tag注解，也可以通过@Tags组合多个标签。</p>
<p><strong>1.标签的语法规则</strong><br>@Tag注解里面的标签值必须遵守下面的规则：</p>
<ul>
<li>标签不能是null或空字符串</li>
<li>去除两端空白字符后的标签中不能包含空白字符（空格、制表符、回车、换行符等等）</li>
<li>去除两端空白字符后的标签中不能包含ISO控制字符</li>
<li>去除两端空白字符后的标签中不能包含下列的保留字符：,()&amp;!|<br>标签两端如果有空白字符（空格、制表符、回车、换行符等等），将被自动去除。</li>
</ul>
<p><strong>2.在构建系统中根据标签过滤测试</strong><br>2.1 在Maven中根据标签过滤测试<br>例如，为了将快速的单元测试和慢速的集成测试分开，我们分别用@Tag(“Unit”)和@Tag(“Integration”)来注解它们。在Maven中，我们可以配置surefire插件来分别筛选单元测试和集成测试。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.22.2&lt;/version&gt;</span><br><span class="line">  &lt;executions&gt;</span><br><span class="line">    &lt;execution&gt;</span><br><span class="line">      &lt;id&gt;unit-test&lt;/id&gt;</span><br><span class="line">      &lt;goals&gt;</span><br><span class="line">        &lt;goal&gt;test&lt;/goal&gt;</span><br><span class="line">      &lt;/goals&gt;</span><br><span class="line">      &lt;phase&gt;test&lt;/phase&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;excludedGroups&gt;integration, acceptance&lt;/excludedGroups&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/execution&gt;</span><br><span class="line">    &lt;execution&gt;</span><br><span class="line">      &lt;id&gt;integration-test&lt;/id&gt;</span><br><span class="line">      &lt;goals&gt;</span><br><span class="line">        &lt;goal&gt;test&lt;/goal&gt;</span><br><span class="line">      &lt;/goals&gt;</span><br><span class="line">      &lt;phase&gt;integration-test&lt;/phase&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;groups&gt;integration&lt;/groups&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/execution&gt;</span><br><span class="line">  &lt;/executions&gt;</span><br><span class="line">  &lt;configuration&gt;</span><br><span class="line">    &lt;includes&gt;</span><br><span class="line">      &lt;include&gt;**<span class="comment">/*&lt;/include&gt;</span></span><br><span class="line"><span class="comment">    &lt;/includes&gt;</span></span><br><span class="line"><span class="comment">  &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">&lt;/plugin&gt;</span></span><br></pre></td></tr></table></figure><br>在上面的pom.xml的maven-surefire-plugin测试插件中，我们配置了两个execution，分别设置单元测试和集成测试。其中id为unit-test的execution绑定到test阶段，排除掉注解了@Tag(“integration”)或@Tag(“acceptance”)的测试。而id为integration-test的execution绑定到integration-test阶段，只包含注解了@Tag(“integration”)的测试。这样，当执行maven构建流水线时，到达单元测阶段就会执行没有包含注解@Tag(“integration”)和@Tag(“acceptance”)注解的测试，到达集成测试阶段就会执行包含了@Tag(“integration”)注解的测试。</p>
<p>说明：</p>
<ul>
<li><groups>元素定义要包含在测试中的标签。而<excludedGroups>元素定义要排除的标签。</li>
<li><groups>和<excludedGroups>元素都支持多个标签项，可以用逗号“,”分隔各个标签项。</li>
<li>可以使用Tag表达式来表达多个标签的组合。操作符包括&amp;、|、!和()。例如<groups>(A | B) &amp; !C</groups>表示包含那些被@Tag(“A”)或@Tag(“B”)注解、但没有被@Tag(“A”)注解的测试。</li>
<li><groups>和<excludedGroups>可以同时使用。例如：</li>
</ul>
<p>2.2 在Gradle中根据标签过滤测试<br>在build.gradle文件的test节中定义类似下面的内容：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test &#123;</span><br><span class="line">    useJUnitPlatform &#123;</span><br><span class="line">        includeTags <span class="string">&#x27;fast&#x27;</span>, <span class="string">&#x27;smoke &amp; feature-a&#x27;</span></span><br><span class="line">        <span class="comment">// excludeTags &#x27;slow&#x27;, &#x27;ci&#x27;</span></span><br><span class="line">        includeEngines <span class="string">&#x27;junit-jupiter&#x27;</span></span><br><span class="line">        <span class="comment">// excludeEngines &#x27;junit-vintage&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>标签表达式和Maven中的相同。</p>
<h3 id="测试执行顺序、嵌套的测试"><a href="#测试执行顺序、嵌套的测试" class="headerlink" title="测试执行顺序、嵌套的测试"></a>测试执行顺序、嵌套的测试</h3><p><strong>测试执行顺序</strong><br>﻿重要性：★★★☆☆<br>如果一个测试类中有多个测试方法，缺省情况下，虽然JUnit会根据一个内在的算法确定这些方法的执行顺序（为了支持“可重复构建”的目标），但是对用户来说，其顺序并不是明显的——测试方法的名称和在测试类中出现的顺序都不是排序的依据。</p>
<p>﻿正常情况下测试类中的每一个测试方法都应该是独立的——它的执行与否以及测试结果都不应该依赖于其他测试方法的预先执行。一个测试方法不应该依赖另一个测试方法为它预设测试条件（例如订单CRUD测试中，查询订单测试不应该依赖于创建订单测试为它先在数据库中创建订单，而应该在自身的setup阶段向数据库中插入测试数据）。<br>﻿<br>但是有的时候，尤其是在集成测试中，因为要与外部系统如数据库等进行交互，测试类中的每个测试方法在setup阶段都要启动数据库并向其中插入数据，就会导致严重的性能问题。这个时候我们可以接受安排测试方法的执行顺序，例如在订单CRUD测试中，安排创建订单测试先执行，向数据库中插入一到多条订单数据，随后执行查询订单测试和修改订单测试，最后执行删除订单测试。</p>
<p>﻿当需要访问外部基础设施（如数据库、消息中间件等等）或者采用PER_CLASS模式执行测试时，定义测试方法的执行顺序比较有意义。</p>
<p>为了定义测试执行顺序，你需要：</p>
<ul>
<li>用@TestMethodOrder注解测试类或测试接口，指定一个MethodOrderer接口的实现类。</li>
<li>如果采用MethodOrderer是MethodOrderer.OrderAnnotation类，在每个要排序的测试方法上添加@Order注解。@Order的值越小，方法越先执行。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.exec_order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.MethodOrderer;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Order;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.TestMethodOrder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TestMethodOrder(MethodOrderer.OrderAnnotation.class)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodOrderTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(20)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">last</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Me last&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(-6)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">first</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Me first&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(0)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">second</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Me second&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(2)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">third</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Me third&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以根据方法名称的字母表顺序进行排序：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.exec_order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.MethodOrderer;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.TestMethodOrder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TestMethodOrder(MethodOrderer.Alphanumeric.class)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlphanumericOrderTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">last</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Named last but second in fact&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">first</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Me first&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">second</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Named second but third in fact&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">third</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Named third but last in fact&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>还可以通过将测试类注解为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestMethodOrder(MethodOrderer.Random.class)</span></span><br></pre></td></tr></table></figure><br>来让测试方法伪随机排序执行。不过通常而言这种方式没啥必要。</p>
<p><strong>嵌套的测试</strong><br>重要性：★★★☆☆</p>
<p>有时候一个测试类中的测试方法太多，有必要根据内聚性原则将它们分组。</p>
<p>﻿可以在测试类的内部定义嵌套内类（不能是静态内类）并注解为@Nested将测试进行分组。在顶层类和嵌套类中都可以定义测试方法和生命周期方法。</p>
<p>﻿嵌套的层级数量没有限制。</p>
<p>﻿如果测试生命周期是PER_METHOD的，嵌套类不允许定义@BeforeAll和@AfterAll生命周期方法。如果测试生命周期是PER_CLASS的，嵌套类中可以定义@BeforeAll和@AfterAll生命周期方法。</p>
<p>如果外层测试类中有定义@BeforeEach和@AfterEach生命周期方法，那么它们也会在嵌套类的每个测试方法前后执行一次。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.nested;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertFalse;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertThrows;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.EmptyStackException;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Nested;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DisplayName(&quot;A stack&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestingAStackDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;is instantiated with new Stack()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">isInstantiatedWithNew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;when new&quot;)</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WhenNew</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">createNewStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;is empty&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">throwsExceptionWhenPopped</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when peeked&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">throwsExceptionWhenPeeked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::peek);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;after pushing an element&quot;)</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">AfterPushing</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            String anElement = <span class="string">&quot;an element&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@BeforeEach</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">pushAnElement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                stack.push(anElement);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;it is no longer empty&quot;)</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">isNotEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when popped and is empty&quot;)</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">returnElementWhenPopped</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                assertEquals(anElement, stack.pop());</span><br><span class="line">                assertTrue(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when peeked but remains not empty&quot;)</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">returnElementWhenPeeked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                assertEquals(anElement, stack.peek());</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一种可行的组织测试代码的方式是：为每个被测试的产品类创建一个对应的测试类。在测试类内部，针对被测类的每个工作单元（一般是方法）分别创建一个注解为@Nested的嵌套类，包含针对这个工作单元的所有测试。</p>
<h3 id="参数化测试"><a href="#参数化测试" class="headerlink" title="参数化测试"></a>参数化测试</h3><p>重要性：★★★★☆<br>有时候，为了能够全面证明代码的正确性，我们需要使用多组不同的数据去测试同一个方法（例如用不同的取款金额去测试取款的结果）。如果针对每组数据分别写一个测试方法，就会非常繁琐。</p>
<p>通过使用@ParameterizedTest注解取代@Test注解，我们可以使用不同的参数值多次调用同一个测试方法，这就是参数化测试。当执行参数化测试的时候，还需要至少定义一个参数源，用来为测试方法提供参数值。</p>
<p>下面是简单的参数化测试例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@ValueSource(strings = &#123; &quot;racecar&quot;, &quot;radar&quot;, &quot;able was I ere I saw elba&quot; &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">palindromes</span><span class="params">(String candidate)</span> </span>&#123;</span><br><span class="line">    assertTrue(StringUtils.isPalindrome(candidate));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>1.添加依赖项</strong><br>要编写参数化测试，必须在项目中添加junit-jupiter-params依赖项。<br>在maven项目中，需要在pom.xml文件中的<dependencies>节添加下面的依赖：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;junit-jupiter-params&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;5.6.2&lt;/version&gt;</span><br><span class="line">  &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><br>在gradle项目中，需要在build.gradle文件中的dependencies节添加以下内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testCompile &#x27;org.junit.jupiter:junit-jupiter-params:5.6.2&#x27;</span><br></pre></td></tr></table></figure><br>如果项目中已经定义了junit-jupiter依赖项，就不需要添加junit-jupiter-params依赖项了。因为前者对后者有传递性依赖。</p>
<p><strong>2.定义参数源</strong><br>2.1 @ValueSource<br>通过指定一个由简单值字面量组成的数组提供参数源。当使用@ValueSource时，测试方法只能有一个来自参数源的参数（依赖注入的其他参数不算）。<br>@ValueSource支持以下的数据类型：<br>short<br>byte<br>int<br>long<br>float<br>double<br>char<br>boolean<br>java.lang.String<br>java.lang.Class<br>例如，下面的代码示例会分别以1，2，3作为参数值调用参数化测试方法testWithValueSource()各一次。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> luobogan.top.tdd.parameterized;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.ParameterizedTest;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.provider.ValueSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.assertThat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParameterizedDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@ValueSource(ints = &#123; 1, 2, 3 &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testWithValueSource</span><span class="params">(<span class="keyword">int</span> argument)</span> </span>&#123;</span><br><span class="line">        assertThat(argument).isGreaterThan(<span class="number">0</span>).isLessThan(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>2.2 @NullSource、@EmptySource和@NullAndEmptySource</strong><br>为了测试被测类方法在接收各种“坏”输入值时方法的行为，我们要给参数化测试方法提供能够提供代表null和空值的参数值。</p>
<ul>
<li>@NullSource：给参数化测试方法提供null作为参数值。这个注解不能用于提供基本类型的值。</li>
<li>@EmptySource：为参数化测试方法提供代表空（empty）的值作为参数值。支持以下类型：java.lang.String, java.util.List, java.util.Set, java.util.Map, 基本类型数组 (例如 int[], char[][], 等等), 对象数组 (例如String[], Integer[][]等等，但不支持上述类型的子类型。对于字符串，会提供空字符串；对于各种集合、Map和数组，提供不包含任何元素的空集合、空Map和空数组。</li>
<li>@NullAndEmptySource：包含了@NullSource 和 @EmptySource的组合注解。</li>
</ul>
<p>上述几个注解都只能应用在仅接收一个来自参数源的参数的参数化测试方法上。<br>下面是代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@NullSource</span></span><br><span class="line"><span class="meta">@EmptySource</span></span><br><span class="line"><span class="meta">@ValueSource(strings = &#123; &quot; &quot;, &quot;   &quot;, &quot;\t&quot;, &quot;\n&quot; &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nullEmptyAndBlankStrings</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">    assertThat(text == <span class="keyword">null</span> || text.trim().isEmpty()).isTrue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的参数化方法分别使用参数null, “”, “ “, “ “, “\t”, “\n” 调用1次，一共6次。@NullSource提供第1个参数null，@EmptySource提供了第2个参数””，@ValueSource提供了其余的4个参数。参数化方法上注解出现顺序决定了参数的顺序。</p>
<p>如果去掉@NullSource和@EmptySource，换成@NullAndEmptySource：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@NullAndEmptySource</span></span><br><span class="line"><span class="meta">@ValueSource(strings = &#123; &quot; &quot;, &quot;   &quot;, &quot;\t&quot;, &quot;\n&quot; &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nullEmptyAndBlankStrings2</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">    assertThat(text == <span class="keyword">null</span> || text.trim().isEmpty()).isTrue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>执行结果和上面一样。这说明@NullAndEmptySource两次提供了参数，第一次是null，第二次是””。</p>
<p><strong>2.3 @EnumSource</strong><br>@EnumSource注解提供一个枚举类型的全部或部分枚举值来为参数化测试方法提供参数值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@EnumSource</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testWithEnumSourceWithAutoDetection</span><span class="params">(ChronoUnit unit)</span> </span>&#123;</span><br><span class="line">    System.out.println(unit);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@EnumSource(ChronoUnit.class)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testWithEnumSource</span><span class="params">(TemporalUnit unit)</span> </span>&#123;</span><br><span class="line">    System.out.println(unit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>@EnumSource注解的值可以忽略掉。当没有给@EnumSource注解指定值时，会使用参数化测试的第一个参数的声明类型。上面的testWithEnumSource()方法必须给@EnumSource注解指定值，因为TemporalUnit不是枚举类型，而作为TemporalUnit接口的实现，ChronoUnit是枚举类型。</p>
<p>如果只想使用枚举类型中的部分枚举值，可以定义@EnumSource注解的names属性，包含那些要作为参数化方法的参数的枚举值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@EnumSource(names = &#123; &quot;DAYS&quot;, &quot;HOURS&quot; &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testWithEnumSourceInclude</span><span class="params">(ChronoUnit unit)</span> </span>&#123;</span><br><span class="line">    assertThat(unit).isIn(ChronoUnit.DAYS, ChronoUnit.HOURS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以通过定义@EnumSource注解的mode属性，微调枚举值的筛选方法。它有4个取值：<br>Mode.INCLUDE：默认选项。包含names属性中定义的枚举值。<br>Mode.EXCLUDE：排除names属性中定义的枚举值。<br>Mode.MATCH_ANY：当names是一组正则表达式时，返回匹配这些表达式之一的枚举值<br>Mode.MATCH_ALL：当names是一组正则表达式时，返回匹配全部这些表达式的枚举值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@EnumSource(mode = EnumSource.Mode.MATCH_ANY, names = &quot;^.*DAYS$&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testWithEnumSourceRegex</span><span class="params">(ChronoUnit unit)</span> </span>&#123;</span><br><span class="line">    assertThat(unit.name()).endsWith(<span class="string">&quot;DAYS&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后续持续更新…</p>
</div></article><div class="post-view__sidebar"><div class="sidebar"><div class="tocbot"><h2>Toc</h2><div class="toc__content"></div></div><h2>Links</h2><div class="sidebar__link"><ul><li><a target="_blank" rel="noopener" href="https://github.com/ulissesjr">Github</a></li></ul></div><h2>Archives</h2><div class="sidebar__archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li></ul></div><h2>Categories</h2><div class="sidebar__categories"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DEV/">DEV</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%96%B0%E7%9F%A5/">新知</a></li></ul></div><h2>Tags</h2><div class="sidebar__tags"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" rel="tag">单元测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A4%E7%9F%A5%E5%A4%A9%E6%80%A7/" rel="tag">认知天性</a></li></ul></div></div></div></div><div class="horizontal-line" style="height: 1px"></div><div class="main__bottom"><div class="pre-next"><a class="pre-button" href="/2021/02/15/%E8%AE%A4%E7%9F%A5%E5%A4%A9%E6%80%A7/">《认知天性》笔记</a><a class="next-button" href="/2021/02/12/hello-world/">Hello World</a></div></div></div></div><div class="footer"><span>©️2021-2021 Designed By&nbsp;<strong><a target="_blank" rel="noopener" href="https://github.com/random-yang">Luobogan  </a></strong> Powered By&nbsp;</span><strong><a target="_blank" rel="noopener" href="https://hexo.io">hexo <br></a></strong><span>备案号: 豫ICP备19011645号-1</span></div><div class="darkmode-mask" id="darkmode-mask"></div><div class="sidebar__button"></div></body></html>